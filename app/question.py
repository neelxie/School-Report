embedded_json = []
AgnesNamulindwa = [{"Category":"Animal","Subcategory":"Pigs","Question_id":11853,"Language":"English","Location of farmer":"Seeta","Question":"Why is my pig having red wounds on the ears","Answer":"This is usually caused by bitting flies"},{"Category":"Animal","Subcategory":"Pigs","Question_id":11872,"Language":"English","Location of farmer":"Kiryandongo","Question":"What are the best feeds for piggery","Answer":"concentrates of a combination of feed ingredients like soya , maize ,maize bran and other concentrates"},{"Category":"Animal","Subcategory":"Pigs","Question_id":11890,"Language":"English","Location of farmer":"Madi Okollo District","Question":"I am a piggery farmer, I have my 5 months old piglets of which they have been diarrating(diarrhoea),lost appetite and weak too.What could be the disease and how can it be prevented so that other can not have such a similar problems","Answer":"It could be an infection due to poor hygiene conditions. this can be contained by administering anti biotics for example alamycine"},{"Category":"Animal","Subcategory":"Pigs","Question_id":11894,"Language":"English","Location of farmer":"Dokolo","Question":"What is biosecurity in piggery","Answer":"These are measure put  in place to safe guard against disease entry into  pig units"},{"Category":"Animal","Subcategory":"Pigs","Question_id":11917,"Language":"English","Location of farmer":"Kiryandongo","Question":"What are the best way to control parasite in piggery","Answer":"By maintaining high level of hygiene through regular cleaning of units and periodic disinfection."},{"Category":"Animal","Subcategory":"Pigs","Question_id":11918,"Language":"English","Location of farmer":"Kiryandongo","Question":"Whats the best way of castrating pigs","Answer":"Pigs can only be castrated by open surgery"},{"Category":"Animal","Subcategory":"Pigs","Question_id":11970,"Language":"English","Location of farmer":"Kiryandongo","Question":"What causes swine fever in piggery ","Answer":"Swine fever is caused by a virus through contact with infected sources "},{"Category":"Animal","Subcategory":"Pigs","Question_id":11971,"Language":"English","Location of farmer":"Kiryandongo","Question":"What are the control measures of swine in piggery?","Answer":"Control measures include;strict emphasis on piggery units entry points by carrying out disinfection of  personnel and machinery equipments"},{"Category":"Animal","Subcategory":"Pigs","Question_id":11972,"Language":"English","Location of farmer":"Kiryandongo","Question":"How many times are pigs supposed eat in a day?","Answer":"Pigs can be fed twice a day that is morning and evening"},{"Category":"Animal","Subcategory":"Pigs","Question_id":11973,"Language":"English","Location of farmer":"Kiryandongo","Question":"What is the gestation period of pigs","Answer":"It is 3 months,3 weeks and 3 days "},{"Category":"Animal","Subcategory":"Pigs","Question_id":11989,"Language":"English","Location of farmer":"Ngora, Uganda","Question":"Why is it important to house pigs?","Answer":"Pigs react to extremes of temperatures and environmental conditions, therefore they need to be protected so that they can perform better"},{"Category":"Animal","Subcategory":"Pigs","Question_id":11990,"Language":"English","Location of farmer":"Ngora","Question":"What are the possible ways of preventing swine fever in pigs?","Answer":"by putting up bio security measures, by not feeding them on left overs from restaurants, by fencing to avoid direct contact with wild animals "},{"Category":"Animal","Subcategory":"Pigs","Question_id":12015,"Language":"English","Location of farmer":"Madi Okollo District","Question":"My sow furrowed 11piglets, the following morning found four piglets dead, what could have gone wrong?","Answer":" These pigglets might have died due to crashing."},{"Category":"Animal","Subcategory":"Pigs","Question_id":12018,"Language":"English","Location of farmer":"Madi Okollo District","Question":"Which breed of pig is good in West Nile?","Answer":"I would recommend cross breeds between large white and land race for easy adaptability to environmental conditions"},{"Category":"Animal","Subcategory":"Pigs","Question_id":12029,"Language":"English","Location of farmer":"Kiryandongo","Question":"What can be done to increase on the number of piglets in sows","Answer":" you can improve on the nutrition, improve on the genetics through cross breeding, carryout continous selection. proper timing of the heat cycle"},{"Category":"Animal","Subcategory":"Pigs","Question_id":12030,"Language":"English","Location of farmer":"Kiryandongo","Question":"What is the gestation period of sows","Answer":"It is 3 months,3 weeks and 3 days "},{"Category":"Animal","Subcategory":"Pigs","Question_id":12031,"Language":"English","Location of farmer":"Isingiro","Question":"What is the best breed in pigs?","Answer":"cambrough is the best pig breed since it has a fast growth rate compared to other breeds, low fat ratio to meat and produces a good number of piglets."},{"Category":"Animal","Subcategory":"Pigs","Question_id":12032,"Language":"English","Location of farmer":"Isingiro","Question":"what is the common disease in pigs?","Answer":"African swine fever is the most common disease in pigs"},{"Category":"Animal","Subcategory":"Pigs","Question_id":12033,"Language":"English","Location of farmer":"Isingiro","Question":"what is the common breeding method in pigs?","Answer":"natural mating the most common breeding method "},{"Category":"Animal","Subcategory":"Pigs","Question_id":12034,"Language":"English","Location of farmer":"Isingiro","Question":"what factors do i consider before starting a piggery project?","Answer":"Let us consider land , labour and enterprenship "},{"Category":"Animal","Subcategory":"Pigs","Question_id":12035,"Language":"English","Location of farmer":"Isingiro","Question":"what are the ways of improving pig meat?.","Answer":"by carrying out breed selection and improving the diet "}]
FranciBalinda = [{"Category":"Crop","Subcategory":"Tomatoes","Question_id":5651,"Language":"English","Location of farmer":"Ngora","Question":"Which is the best season for planting tomatoes?","Answer":"Tomatoes are annual crops which can be harvested under One growing season.  plant tomatoes at the beginning of rainy season but if you have an irrigation system and a greenhouse, you can plant tomatoes anytime or all year round depending on availability of water and the inputs"},{"Category":"Crop","Subcategory":"onions","Question_id":5622,"Language":"English","Location of farmer":"Ngora","Question":"Why is it that when slicing one's my eyes normally cry and even mucus comes out?","Answer":"while slicing onions, the sap\/fluid produced by the onion is regarded as a foreign body in the eyes. onions also acidic sap which causes the itchy effect. the pungent smell causes the release of mucus from the nose"},{"Category":"Animal","Subcategory":"Tomatoes","Question_id":5236,"Language":"LUganda","Location of farmer":"Wakiso","Question":"E box ye nnyanya eri ku sente meka?","Answer":"Kisinziira kku season\/sizoni nne'akatele wo'tundila"},{"Category":"Crop","Subcategory":"tomatoes","Question_id":8627,"Language":"English","Location of farmer":"Uganda","Question":"When is mulching necessary in tomato farming, and what are the steps involved in the process?","Answer":"mulching plays an important role in Tomato growing. Mulching help to preseving water in the soil. mulching decay and improve soil fertility. it is advisable to mulch after plantin."},{"Category":"Crop","Subcategory":"Tomatoes","Question_id":9715,"Language":"English","Location of farmer":"Ngora, Uganda","Question":"What are the constraints to tomato production?","Answer":"The major constraints are lack of knowlege. Please have land, agro inputs."},{"Category":"Crop","Subcategory":"Egg plant","Question_id":9757,"Language":"English","Location of farmer":"Ngora, Uganda","Question":"What ways can a farmer maintain soil fertility","Answer":"Apply manure, applying fertilizers, crop rotation, mulching, proper\/timely weeding."},{"Category":"Crop","Subcategory":"Vegetables","Question_id":12153,"Language":"English","Location of farmer":"Moroto","Question":"At what stage of plant growth must I apply organic manure?","Answer":"organic manure is always applied at planting under spot application in the hole."},{"Category":"Crop","Subcategory":"Vegetables","Question_id":12154,"Language":"English","Location of farmer":"Moroto","Question":"Whats the best way of controlling diseases in my vegetables?","Answer":"The best way of controlling diseases is by use of IPM methods. basically, have good agronomic practices such as weeding,mulching, proper spacing, use of tolerant varieties. always do field scounting and garden scounting to observe pest and disease incidence."},{"Category":"Crop","Subcategory":"Vegetables","Question_id":12155,"Language":"English","Location of farmer":"Moroto","Question":"How helpful is crop rotation in disease control in a vegetable garden?","Answer":"crop rotation breaks the pest life cycle in the garden. most disease are caused by pests in the garden"},{"Category":"Crop","Subcategory":"Tomatoes","Question_id":12305,"Language":"English","Location of farmer":"Kamwenge, Uganda","Question":"Whats agro inputs in relation to Agriculture","Answer":"Agro inputs are all the material in terms of chemical liquids or powder that are used in agriculture for example, pesticides, fungicides fertilizers among others"}]
GodfreySeruwu = [{"Category":"Crop","Subcategory":"cassava","Question_id":8270,"Language":"English","Location of farmer":"Uganda","Question":"What are the common diseases that attack cassava in Uganda, outline their signs and symptoms in their early and late stages .","Answer":"The common diseases that attack cassava include Cassava brown streak disease (CBSD), cassava mosaic disease (CMD), Cassava bacterial blight. The symptoms of CBSD include: Thin yellow lines commonly called chlorosis occurring along and spreading between small veins of green leaves; In mature cassava plants, when the older leaves turn yellow or become senescent, the thin yellow lines turn green; leaves showing symptoms of CBSD retain their normal shape and are not distorted or reduced in shape. Symptoms of CBSD on the stem: Brown \"streak\" on the stems; The streaks appear as scratches or wounds on the stem; The streaks appear clearly on the young green portion of the stems; In susceptible varieties, the shoot tips may dry and fall off and this may progress and affect the whole plant resulting into \"stem die-back\"; In severe instances the whole plant may die. Symptoms on storage roots: Portions of the edible part of the storage root appear dark brown, dry, and hard; The dry and hard portions consist of dead tissue which is characteristic of the disease; In some varieties, CBSD causes root constrictions, twisting, and size reduction (shrinking) of te storage root forming strings of beads appearance; The outer skin of the storage root may develop cracks on the surface"},{"Category":"Crop","Subcategory":"cassava","Question_id":8272,"Language":"English","Location of farmer":"Uganda","Question":"Can CBSD resistant cassava be grown in any part of Uganda.","Answer":"Yes. At the moment we have NAROCASS 1and it can grow very well anywhere in Uganda"},{"Category":"Crop","Subcategory":"cassava","Question_id":8279,"Language":"English","Location of farmer":"Uganda","Question":"what are the befits of growing cassava in uganda?","Answer":"Cassava is both a cash crop and a food crop\/food security crop. Therefore it can be grown for sale to get cash or for food"},{"Category":"Crop","Subcategory":"cassava","Question_id":8280,"Language":"English","Location of farmer":"Uganda","Question":"Which of these cassava varieties is better for commercial cassava growing in Uganda , Nakpologoma,Nase 3,Nakatembe,Nase 14,NAROCASS 1,NAROCASS 2","Answer":"At the moment NAROCASS 1 is the best commercial variety across the country. This is followed by NASE 13 and NASE 3. Commercially, NAROCASS 2 is not very good because it has small roots and the yield is low"},{"Category":"Crop","Subcategory":"cassava","Question_id":8282,"Language":"English","Location of farmer":"Kiryandongo","Question":"list pests that attack cassava in kiryandongo apart from rodents amd humans","Answer":"Cassava mite, white flies, thrips, scale insects"},{"Category":"Crop","Subcategory":"cassava","Question_id":8286,"Language":"English","Location of farmer":"Kasese, Budinbugyo","Question":"which special methods can be used to farm cassava in hilly areas like those in kasese and bundibujo","Answer":"There are no specially planting methods for cassava but planting should be done along the contour. You can do verticle planting where two-thirds of the cutting is buried in the soil or horizontal planting where the entire cutting is buried"},{"Category":"Crop","Subcategory":"cassava","Question_id":8288,"Language":"English","Location of farmer":"Kiboga","Question":"How can i detect different cassava diseases on my cassava farm in kiboga basing on their signs .","Answer":"The common diseases that attack cassava include Cassava brown streak disease (CBSD), cassava mosaic disease (CMD), Cassava bacterial blight. The symptoms of CBSD include: Thin yellow lines commonly called chlorosis occurring along and spreading between small veins of green leaves; In mature cassava plants, when the older leaves turn yellow or become senescent, the thin yellow lines turn green; leaves showing symptoms of CBSD retain their normal shape and are not distorted or reduced in shape. Symptoms of CBSD on the stem: Brown \"streak\" on the stems; The streaks appear as scratches or wounds on the stem; The streaks appear clearly on the young green portion of the stems; In susceptible varieties, the shoot tips may dry and fall off and this may progress and affect the whole plant resulting into \"stem die-back\"; In severe instances the whole plant may die. Symptoms on storage roots: Portions of the edible part of the storage root appear dark brown, dry, and hard; The dry and hard portions consist of dead tissue which is characteristic of the disease; In some varieties, CBSD causes root constrictions, twisting, and size reduction (shrinking) of te storage root forming strings of beads appearance; The outer skin of the storage root may develop cracks on the surface. Symptoms of common bacterial blight first appear on leaves as small, water-soaked spots, light green areas, or both. As these spots enlarge, the tissue in the center dies and turns brown. These irregularly shaped spots are bordered by a lemon-yellow ring, which serves as a diagnostic symptom of common bacterial blight. Symptoms for Cassava Mosaic Disease include chlorotic mosaic of the leaves, leaf distortion, and stunted growth. Leaf stalks have a characteristic S-shape. "},{"Category":"Crop","Subcategory":"cassava","Question_id":8295,"Language":"English","Location of farmer":"Iganga","Question":"which methods can i use to increase yields on my cassava farm in Iganga?","Answer":"Yields for cassava can increased by planting high yielding varieties like, NAROCASS 1; Planting disease-free cuttings, and good land preparation, where the soils are very poor or infertile TSP or SSP can be applied at a rate of 5o kg per acre"},{"Category":"Crop","Subcategory":"cassava","Question_id":8299,"Language":"English","Location of farmer":"Amuriat","Question":"how can i add value to my cassava and rabbits products in Amuriat district?","Answer":"You can add value to cassava by peeling, washing, and chipping the cassava storage roots either with a motorized chipper or by hand. This should be dried on clean tarpaulins. The chips can be milled to make high-quality flour or can be used to make animal feeds, alcohol, starches for sizing paper and textiles, sweeteners. For the rabbits, the rabbits should be slaughtered and the meat roasted and sold directly to consumers or after slaughtering the meat can be packaged in good display materials and sold in high end supermarkets"},{"Category":"Crop","Subcategory":"cassava","Question_id":8301,"Language":"English","Location of farmer":"Luweero","Question":"what are the efficient methods to propagate cassava in luweero?","Answer":"The efficient method to propagate cassava is is using disease-free stem cuttings"},{"Category":"Crop","Subcategory":"cassava","Question_id":8308,"Language":"English","Location of farmer":"Uganda","Question":"What are common spacing criteria applied in cassava farming in Uganda for both small scale and large scale farms. highlight advantages and disadvantages for each criteria","Answer":"The recommended spacing for cassava in Uganda is 1 x 1 M. The advantage here is you get a high plant population per unit area thus high yields"},{"Category":"Crop","Subcategory":"cassava","Question_id":8309,"Language":"English","Location of farmer":"Uganda","Question":"What are the major factors affecting the demand of cassava and its products in Uganda","Answer":"The cassava roots are highly perishable and at the same time very bulky"},{"Category":"Crop","Subcategory":"groundnuts","Question_id":8334,"Language":"English","Location of farmer":"Uganda","Question":"Provide 3 facts on optimal soil and weather conditions for growing groundnuts in Uganda.","Answer":"Groundnut production requires deep, well drained sandy, sandy loam or loamy sand soils. The optimum temperatures are 27\u201330 \u00b0C for vegetative growth and 24\u201327 \u00b0C for reproductive growth and between 450 mm and 1250 mm of evenly distributed rainfall is required annually for good growth and yield."},{"Category":"Crop","Subcategory":"groundnuts","Question_id":8339,"Language":"Luganda","Location of farmer":"Mbale","Question":"Banga ki elyetaagisa ng'osimba ebinyeebwa mu disitulikiti ye Mbale?","Answer":"Bwetuba  bakusimba mu nyiriri gano gemabanga getukozesa. 45 x15 cm (okuva ku line emu okudda kundala tulekawo 45 cm\/1.5 ft at okuva ku kikolo ekimu okutuuka kukirala tulekawo 15 cm\/0.5 ft. Eryo lyebbanga bwetuba tusiimbye ebinyebwa ebyaggaagala nga Igola-1. Bwetusiimba ebinyeebwa ebikula biddawagulu tukozesa 45 x 10 cm "},{"Category":"Crop","Subcategory":"groundnuts","Question_id":8371,"Language":"English","Location of farmer":"Uganda","Question":"What is the total cost of preparing 5 square miles of land for groundnut cultivation in Uganda, given that 2 acres require UGX 50,000?","Answer":"One Square mile has 640 acres. If two acres require Shs. 50,000, then one acre requires 5\/2 which is 25,000. Therefore 5 square miles will be will cost 5*640*25,000 =Shs. 80,000,000"},{"Category":"Crop","Subcategory":"groundnuts","Question_id":8374,"Language":"English","Location of farmer":"Uganda","Question":"What other factors affect proper groundnut cultivation apart from warm climate, well-drained sandy loam soils, and full sun exposure?","Answer":"The other factors are pests like Thrips, Aphids, beetles, and diseases like groundnut rosette, anthracnose, Ascochyta leaf spots"},{"Category":"Crop","Subcategory":"cassava","Question_id":8617,"Language":"English","Location of farmer":"Rukungiri","Question":"Describe the stages and symptoms of Cassava Brown Streak Disease for Rukungiri farmers.","Answer":"The common diseases that attack cassava include Cassava brown streak disease (CBSD), cassava mosaic disease (CMD), Cassava bacterial blight. The symptoms of CBSD include: Thin yellow lines commonly called chlorosis occurring along and spreading between small veins of green leaves; In mature cassava plants, when the older leaves turn yellow or become senescent, the thin yellow lines turn green; leaves showing symptoms of CBSD retain their normal shape and are not distorted or reduced in shape. Symptoms of CBSD on the stem: Brown \"streak\" on the stems; The streaks appear as scratches or wounds on the stem; The streaks appear clearly on the young green portion of the stems; In susceptible varieties, the shoot tips may dry and fall off and this may progress and affect the whole plant resulting into \"stem die-back\"; In severe instances the whole plant may die. Symptoms on storage roots: Portions of the edible part of the storage root appear dark brown, dry, and hard; The dry and hard portions consist of dead tissue which is characteristic of the disease; In some varieties, CBSD causes root constrictions, twisting, and size reduction (shrinking) of te storage root forming strings of beads appearance; The outer skin of the storage root may develop cracks on the surface"},{"Category":"Crop","Subcategory":"beans","Question_id":8646,"Language":"Luganda","Location of farmer":"Uganda","Question":"Nyinza ntya okusanyawo obusanyi obulumbye enimiro yange eye bijanjalo emukono","Answer":"Enkola enyangu ey'okusanyawo obusanyi ya kufura ne ddagala. Oyinza okozesa roket, cypermethrin etc"},{"Category":"Crop","Subcategory":"beans","Question_id":8651,"Language":"Luganda","Location of farmer":"Uganda","Question":"Mpayo engeri satu abalimi bebijanjalo mu distrikiti yembale gyebayinza okukuumamu ebijanjalo byabwe nga bamaze okubikungula okusobola okukakasa nti tebilibwa buwuka","Answer":"Oyinza okukozesa kyetuyita hermetic storage tanks or bags era osobola okukozeza obusawo obuyitibwa PICS bags, Ebijanjalo bitereke nga tobiweye"},{"Category":"Crop","Subcategory":"beans","Question_id":8658,"Language":"English","Location of farmer":"Mbarara","Question":"Attending a farmer meeting in Mbarara, the presenter emphasized optimal spacing for beans; whats the recommended spacing between beans and the number per hole in Mbarara?","Answer":"For recommended spacing for beans is 50cm x 10 cm for one seed per hole. if we are to use two seeds per hole then we plant at 50x20 cm"},{"Category":"Crop","Subcategory":"Groundnuts","Question_id":9735,"Language":"English","Location of farmer":"Ngora, Uganda","Question":"How can a farmer control ground nut rosette","Answer":"Plant early at the onset of rains, plant  at a closer spacing to confuse the vectors (high density planting); plant tolerant \/ resistant varieties, e.g. Serenut 14; Remove virus-infected plants after harvest, and volunteer plants that are primary source of infection."},{"Category":"Crop","Subcategory":"Groundnuts","Question_id":9737,"Language":"English","Location of farmer":"Ngora, Uganda","Question":"What should a farmer do to manage early leaf spot","Answer":"The best way to manage the leaf spots in groundnuts is by growing resistant and early maturing varieties; plant the new crop far away from old groundnut gardens; Crop rotation, spray with a fungicide as soon as leaf spots are seen, even if they appear only on one or a few plants. Spray every 10-14 days, continuing until 14 days before harvest. "},{"Category":"Crop","Subcategory":"Groundnuts","Question_id":9738,"Language":"English","Location of farmer":"Ngora, Uganda","Question":"What causes late leaf spot","Answer":"Leaf spots are caused by a fungus called Mycosphaerella berkeleyi. Its spread is encouraged by wind, rain-splash, and insects which spread the spores. The fungi survives on volunteer groundnut plants and infected crop debris. \n"},{"Category":"Crop","Subcategory":"Groundnuts","Question_id":9739,"Language":"English","Location of farmer":"Ngora, Uganda","Question":"What factors should a farmer consider to manage late leaf spot","Answer":"The best way to manage the leaf spots in groundnuts is by growing resistant and early maturing varieties; plant the new crop far away from old groundnut gardens;crop rotation, spray with a fungicide as soon as leaf spots are seen, even if they appear only on one or a few plants. Spray every 10-14 days, continuing until 14 days before harvest. "},{"Category":"Crop","Subcategory":"Cassava","Question_id":9801,"Language":"English","Location of farmer":"Ngora, Uganda","Question":"What control measures should a farmer consider to manage white flies","Answer":"There are several ways of controlling white flies namely;use of reflective mulches can repel whiteflies from gardens, and yellow sticky traps can be used to monitor or, at high levels, reduce whitefly numbers, and the use of insecticidal soaps or oils such as neem oil may reduce the whitefly population."},{"Category":"Crop","Subcategory":"crops","Question_id":8289,"Language":"English","Location of farmer":"Katebo, Mpigi","Question":"how many 10 litre back pump are sufficient for spraying my half acre garden in katebo village in Mpigi with 500ml of Fluometuron herbicides","Answer":"Ten pumps"},{"Category":"Crop","Subcategory":"maize","Question_id":8344,"Language":"Luganda","Location of farmer":"Uganda","Question":"Budde ki mu mwaka obusinga obulungi okulima kasooli?","Answer":"Kino kisinziraetutundu mwobera. Season eyokubiri yesinga enkuba enyinji. SOM "},{"Category":"Crop","Subcategory":"crops","Question_id":8348,"Language":"English","Location of farmer":"Wakiso","Question":"What crop thrives best in Wakiso, characterized by isolated flat-topped hills?","Answer":"Wakiso is a well-endowed district and most of the crops can grow there. Maize will do very well even at flat tops."},{"Category":"Crop","Subcategory":"maize","Question_id":8355,"Language":"English","Location of farmer":"Mawogola, Sembabule","Question":"Kanyogoga is a village in Mawogola county in Sembabule district. The county is part of the cattle corridor in Uganda and is characterized by long dry spells. What are the best months of the year to plant maize in Kanyogoga?","Answer":"The best months of the year to plan maize in Mawogola sub-county are March and September"},{"Category":"Crop","Subcategory":"sweet potatoes","Question_id":8439,"Language":"English","Location of farmer":"Uganda","Question":"What are the benefits of incorporating sweet potatoes into crop rotation systems.","Answer":"It helps to break up life cycles for the pests"},{"Category":"Crop","Subcategory":"sweet potatoes","Question_id":8441,"Language":"Luganda","Location of farmer":"Uganda","Question":"Nsobola ntya okulwanyisa obulungi ebiwuka mu kulima lumonde?","Answer":"Simba amalagala agatalina biwuka; nojolako obuwuka ku bikoola obuziike; bwebuba bulemeddewo fuyira neddagala and cypermethrin"},{"Category":"Crop","Subcategory":"sweet potatoes","Question_id":8457,"Language":"English","Location of farmer":"Uganda","Question":"How long do sweet potatoes take to grow to maturity?","Answer":"The maturity of sweet potatoes greatly depends on the variety. The maturity ranges from 3-6 months"},{"Category":"Crop","Subcategory":"sweet potatoes","Question_id":8469,"Language":"English","Location of farmer":"Uganda","Question":"Summarize key points for growing sweet potatoes, focusing on planting methods, vine cutting criteria, and mound construction from prior workshops. Provide a new tip","Answer":"In sweetpotato production, we mainly use two planting methods i.e. the ridge and the mound methods. The ridge method is suitable for hilly areas where erosion is a big problem but not suitable for areas with so many underground vermin. The mound method is suitable for flat lands. When selecting vines for planting, cut the top most part of the vine. The top most part of the vine is prefeered because it has the lowest concentration of virus load. Cut vines of about 30cm."},{"Category":"Crop","Subcategory":"sweet potatoes","Question_id":8479,"Language":"English","Location of farmer":"Uganda","Question":"Recommend sweet potato varieties based on their growth duration and gestation period","Answer":"Sweetpotato can be white-fleshed or orange-fleshed. The white-fleshed sweetpotato include; NAspot 11 which matures in 4-5 months, others include Narospot 1 variety"},{"Category":"Crop","Subcategory":"Oranges","Question_id":9804,"Language":"English","Location of farmer":"Uganda","Question":"Can I turn an orange plant to mango plant?","Answer":"No. Its not possible because they belong to different Genera"},{"Category":"Crop","Subcategory":"Oranges","Question_id":9832,"Language":"English","Location of farmer":"Uganda","Question":"What can I use for prunning my mango plant?","Answer":"Use a pair secateurs or pruning knife"},{"Category":"Crop","Subcategory":"Sweet potatoes","Question_id":9843,"Language":"English","Location of farmer":"Uganda","Question":"What variety of sweet potatoes is better for growing in teso?","Answer":"NAROSPOT1"},{"Category":"Animal","Subcategory":"Jackfruit","Question_id":9879,"Language":"English","Location of farmer":"Uganda","Question":"How can I make my jackfruit survive drought?","Answer":"By irrigating it at least once a week with 10 litres of water per week"},{"Category":"Crop","Subcategory":"Mango","Question_id":10028,"Language":"English","Location of farmer":"Ngora, Uganda","Question":"What are the control measures for mango malformation disease","Answer":"The malformation is as a result of the mango fruit fly. Use fruit fly pheromone traps to kill the fruit fly; sanitation in your orchard by picking and burrying all infested manufruits"}]
IanBenya = [{"Category":"Animal","Subcategory":"animals","Question_id":8448,"Language":"English","Location of farmer":"Kampala","Question":"How can I effectively manage a mixed livestock system on my three-acre farm near Kampala, including goats, chickens, and cows, alongside crops?","Answer":"One can best utilize the land by realing these livestock using the intensive rearing systems. The intesive systems can obe established on one acre, and then dedicate the other two for growing pastures (Over sowing methosd). A farmer can also utilise fodder shrubs like caliadra which can be planted on bounderies of the three acres. The fodder does not only provide proteins to animals, but also help in fixing N2 in the soil hence improving soil fertility. "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11048,"Language":"English","Location of farmer":"Isingiro","Question":"What are common practices in zero-grazing cattle?","Answer":"Cutting and carying the forage, fodder,  water to the animal to feed, Cleaning the cattle pen to collect the dung for proper disposal. "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11159,"Language":"English","Location of farmer":"Mbarara","Question":"How does one determine the number of cattle and size of land where they could comfortably feed and move?","Answer":"By determing the carrying capacity"},{"Category":"Animal","Subcategory":"Cattle","Question_id":11350,"Language":"English","Location of farmer":"Mbarara","Question":"How is sillage made and then stored?","Answer":"Silage is made from psture grass, fodder such as maize, elephant grass and other animal edible plants. The pasture or fodder is harvested at flowering stage, and the chooped into sizable pieces. Then additives such as molases can be added or mixed in  to improve on paratability. It is then packed and compressed in aire tight materials to ensure there is no oxgyen. It can the bestored in silage stacks above the ground or in containers, Polythene bags and underground pits. "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11664,"Language":"English","Location of farmer":"Mbarara","Question":"How worthy is animal insurance ?","Answer":"This is one of the important areas to study. I believe animal insurance would be very good for animal keepers especially during the festival seasons where we experince the highest thefts of animals, or incase the poultry house caught fire. "},{"Category":"Animal","Subcategory":"Goats","Question_id":11679,"Language":"English","Location of farmer":"Butambala","Question":"Is there ready market for maize provided by government to help farmers deal with price fluctuations?","Answer":"Yes, there is."},{"Category":"Animal","Subcategory":"Goats","Question_id":11680,"Language":"English","Location of farmer":"Butambala","Question":"What causes the animal to continuously be pouring saliva?","Answer":"Foot and Mouth disease"},{"Category":"Animal","Subcategory":"Goats","Question_id":11694,"Language":"English","Location of farmer":"Butambala","Question":"What causes a running stomach in goats and what can you use to treat it?","Answer":"It is caused by tape worms. These can be treated by dewarming."},{"Category":"Animal","Subcategory":"Goats","Question_id":11695,"Language":"English","Location of farmer":"Butambala","Question":"What causes insects collecting on goats eyes? And how do we prevent it?","Answer":"Insects can be attracted by a sick eye, they can be prevented by spraying an acaricide "},{"Category":"Animal","Subcategory":"Goats","Question_id":11703,"Language":"English","Location of farmer":"Butambala","Question":"Why dont goats drink water unless it is very hot in the day, how can I get them to drink more?","Answer":"Goats do drink water. But for them being small ruminants, their metabolism is not as high as that of cows and maybe they might take less water. But it is important to alaways avail water to the goats so that they can take it when they want."},{"Category":"Animal","Subcategory":"Goats","Question_id":11705,"Language":"English","Location of farmer":"Butambala","Question":"What value addition products can I utilize for my goats meat and how easy or hard is it for me to get started?","Answer":"Value on gots meat can be added is different ways. One can slaughter the goat, properly cutt the meat into good shape and package and brand it for selling and distribution in supper markets. One can also smash the meat and make susage for roasting and deep frying. The main chllange is to access basic equipment and cutting machinery like deep freezer, and electricity."},{"Category":"Animal","Subcategory":"Goats","Question_id":11714,"Language":"English","Location of farmer":"Butambala","Question":"What remedies can I use to deworm my cattle, does the same work for goats and sheep?","Answer":"One can use dewarming drugs like benzimidazoles and imidazothiazoles. Both drugs can be used to dewarm goats, though the dosage differs. "},{"Category":"Crop","Subcategory":"Cattle","Question_id":11715,"Language":"English","Location of farmer":"Butambala","Question":"What are the preferred measurements for salt to be added to animal feed and how often?","Answer":"This depends on the Age, of the animal and quantity of the feed. It is important to always add salt evry time one is going to give feeds to the animal.  "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11741,"Language":"English","Location of farmer":"Kampala","Question":"How do I use the modern technology in book keeping my fish records","Answer":"This could be keeping fish records in soft copy form using a computer. Also one can develpe a data base system where data can be recorded and stored. There is also some applications that can be used to store records. "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11743,"Language":"English","Location of farmer":"Kampala","Question":"How do I manage cattle health, disease prevention and treatment","Answer":"This can acieved through observing the biosecurity measures and proper hygien on the farm. "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11745,"Language":"English","Location of farmer":"Kampala","Question":"What are the best milking practices for dairy cattle","Answer":"Pre-milking practices like washing and drying the milking utensils, Preparing the feeds at the milking pala, the milker must wash their hands with soap and dry with a clean towel, Strip cup to detect early stages of clinical mastitis, restraining the animal to be milked, apply milking salve, removing the cow from the milking place. "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11746,"Language":"English","Location of farmer":"Kampala","Question":"What are the strategies for managing cattle nutrition requirements","Answer":"Monitoring the health status of the cattle so that it feeds weel, Monitoring feeding and forage quality. "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11747,"Language":"English","Location of farmer":"Kampala","Question":"How best can I market my cattle products in the market","Answer":"By adding value on the products such as making youhgurt from milk, this increases the shlef life of the milk. "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11748,"Language":"English","Location of farmer":"Kampala","Question":"What are the environmental considerations in cattle farming","Answer":"Observing the carrying capacity to manage the grazing pressure. Proper waste management to reduce on gass emissions."},{"Category":"Animal","Subcategory":"Cattle","Question_id":11749,"Language":"English","Location of farmer":"Kampala","Question":"What are the best feeding techniques for calves","Answer":"Bucket feeding and nipple bottles."},{"Category":"Animal","Subcategory":"Cattle","Question_id":11752,"Language":"English","Location of farmer":"Kampala","Question":"What are the features to consider in designing optimal housing for livestock","Answer":"Animal type, Number of animals, direction of the sun rise and set, Location of the home stead, Security, size of the land \/space. "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11754,"Language":"English","Location of farmer":"Kampala","Question":"How can farmers prevent diseases in cattle","Answer":"By observing biosecurity, Through vaccination, Quaratining the sick animals. "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11755,"Language":"English","Location of farmer":"Kampala","Question":"What are the suitable practices for maximizing animal productivity in agriculture","Answer":"Optimize breeding programs, carry out rotational grazing, quality feeds for animals, regular health monitoring and supervision, efficient record keeping, diversifying of livestock products, market research and networking, proper housing\/infrastructure."},{"Category":"Animal","Subcategory":"Goats","Question_id":11756,"Language":"English","Location of farmer":"Kampala","Question":"How does climate change impact animal husbandry","Answer":"By affecting livestock growthrates, reduced milk and egg production, reduced reproductivity and animal welfare, morbidity, and mortality"},{"Category":"Animal","Subcategory":"Cattle","Question_id":11758,"Language":"English","Location of farmer":"Kampala","Question":"How can farmers integrate rational grazing systems for better pasture management","Answer":"By proper planning which allows grazing to happen when pastures reach there optimal resting period thus promoting rigorous pasture regrowth. By designing paddocks in such a way that allows animals to have free access to water and shed."},{"Category":"Animal","Subcategory":"Cattle","Question_id":11759,"Language":"English","Location of farmer":"Kampala","Question":"What are the advancements in reproductive technologies for livestock breeding","Answer":"Fixed time artificial insemination, Sexed semen, Embryo transfer "},{"Category":"Animal","Subcategory":"Cattle","Question_id":11767,"Language":"English","Location of farmer":"Kampala","Question":"How do weather conditions influence selling of market products","Answer":"Hort waether conditions might influence some hormones in products like ethylene in fruits which induces rippening, hence reducing the shelf life of the product. Other animal products may go bad once exposed to hort weater conditions. "},{"Category":"Crop","Subcategory":"Cattle","Question_id":11768,"Language":"English","Location of farmer":"Kampala","Question":"How do I increase the demand for my milk products","Answer":"By adding value on it. e.g. make chees, ghee or youhgurt "}]
JacklineAol = [{"Category":"Animal","Subcategory":"Chicken","Question_id":10241,"Language":"English","Location of farmer":"Uganda Wakiso","Question":"What are quality parameters in poultry meat","Answer":"The proper dressing of birds in the abattoir and right temperatures in the store.Use of proper temperature in the chiller of about 18 degrees Celsius"},{"Category":"Animal","Subcategory":"Chicken","Question_id":10242,"Language":"English","Location of farmer":"Wakiso Uganda","Question":"How can one avoid production of broken and dirty eggs","Answer":"when you have enough laying nest and you put litters into your nest provides broken and dirty."},{"Category":"Animal","Subcategory":"Chicken","Question_id":10243,"Language":"English","Location of farmer":"Kampala, Uganda","Question":"What causes double york eggs","Answer":"when you give the chicken quality feeds with enough balance diets."},{"Category":"Animal","Subcategory":"Chicken","Question_id":10244,"Language":"English","Location of farmer":"Kampala, Uganda","Question":"Why are a double york eggs taken to be abnormal","Answer":"because they can't hatch into chicks."},{"Category":"Animal","Subcategory":"Chicken","Question_id":10245,"Language":"English","Location of farmer":"Kampala, Uganda","Question":"What causes too small eggs seen in laying birds could it be nutritional deficiency","Answer":"yes it can be one of the causes and also when the birds have Newcastle disease in laying flock."},{"Category":"Animal","Subcategory":"Chicken","Question_id":10246,"Language":"English","Location of farmer":"Kampala, Uganda","Question":"What causes loss of feathers in breeder birds","Answer":"the nutrients deficiency because they suspend a lot of time on the eggs."},{"Category":"Animal","Subcategory":"Chicken","Question_id":10250,"Language":"English","Location of farmer":"Kampala, Uganda","Question":"What causes production of eggs with fishy smell in poultry","Answer":"when the birds eat larger quantities of fish meal in the diet."},{"Category":"Animal","Subcategory":"Chicken","Question_id":10251,"Language":"English","Location of farmer":"Kampala, Uganda","Question":"How can one avoid or control fishy smell in poultry products","Answer":"when you give them the recommended quality fish meal in the diet."},{"Category":"Animal","Subcategory":"Chicken","Question_id":10247,"Language":"English","Location of farmer":"Wakiso Uganda","Question":"What causes fowl pox in birds and its control","Answer":"It is caused by a virus from mosquitoes and can be controlled by vaccination with fowl pox vaccine."},{"Category":"Animal","Subcategory":"Chicken","Question_id":10254,"Language":"English","Location of farmer":"Kampala, Uganda","Question":"How does poor aeration in poultry house affects the quality of birds produced","Answer":"because the birds will not have format growths it can affect."},{"Category":"Animal","Subcategory":"Chicken","Question_id":10261,"Language":"English","Location of farmer":"Wakiso Uganda","Question":"What are the difference between live vaccines and killed vaccines used in prevention of diseases in poultry","Answer":"Live vaccines are vaccines used to treating virtual diseases."},{"Category":"Animal","Subcategory":"Chicken","Question_id":10280,"Language":"English","Location of farmer":"Kabarole","Question":"Between kroilers and broilers which is good for poultry keeping","Answer":"Broilers are best because they grow for short periods of time and mature for sale."},{"Category":"Animal","Subcategory":"Chicken","Question_id":11058,"Language":"English","Location of farmer":"Wakiso","Question":"What causes vent prolapse in layers?","Answer":"It's majorly caused by too much fat deposits around the abdominal region thus narrowing the pass way for egg"},{"Category":"Animal","Subcategory":"Chicken","Question_id":11085,"Language":"English","Location of farmer":"Kampala Uganda","Question":"What causes prolapse in chicken broilers?","Answer":"Too much fat deposits around the abdominal region"}]
JanetNkozire = [{"Category":"Animal","Subcategory":"Pigs","Question_id":10291,"Language":"English","Location of farmer":"Uganda","Question":"How do you mix the feeds","Answer":"while mixing feeds, one should ensure it has got the ingdrients in it, forexample, protien source, carbrahdrates, and minerials. this makes up a balanced diet feed. then mix the feed by truning at least 4 times in a clean place. "},{"Category":"Animal","Subcategory":"Pigs","Question_id":10292,"Language":"English","Location of farmer":"Uganda","Question":"How big should the structure of pigs be in terms of width and height","Answer":"the pig structure should be 3 meters wide and 5 meters height however, in the width it depends on the number of pigs stocked"},{"Category":"Animal","Subcategory":"Pigs","Question_id":10293,"Language":"English","Location of farmer":"Uganda","Question":"How should a floor look like i.e should it be concrete or it should be soul bare, or put like the coffee hasks or timber hasks' soft floor","Answer":"when the floor is concrete, it should be slatted inorder to allow easy cleaning "},{"Category":"Animal","Subcategory":"Pigs","Question_id":10294,"Language":"English","Location of farmer":"Uganda","Question":"How should the lighting of the structure be, do we need natural light?","Answer":"yes we need natural light in the pig structure, so it should be constructed in a way it allows the light in"},{"Category":"Animal","Subcategory":"Pigs","Question_id":10295,"Language":"English","Location of farmer":"Uganda","Question":"Whats the standard temperature for piglets between 1 month and 2 months","Answer":"75-85 degrees F"},{"Category":"Animal","Subcategory":"Pigs","Question_id":10296,"Language":"English","Location of farmer":"Uganda","Question":"How should the feeders look like?","Answer":"the feeder should be u- shaped that allows only the head of the pig inorder to avoid pouring of the feed from the feeder while feeding"},{"Category":"Animal","Subcategory":"Pigs","Question_id":10299,"Language":"English","Location of farmer":"Uganda","Question":"Which breed of pigs is best for pork production?","Answer":"500g "}]
RichardLumu = [{"Category":"Animal","Subcategory":"pigs","Question_id":8259,"Language":"English","Location of farmer":"Kabarole","Question":"list the causes of pigs diseases in kabarole","Answer":"There several causes of diseases in pigs, these include, viral, bacterial,protozoan and nutritional effects."},{"Category":"Animal","Subcategory":"pigs","Question_id":8260,"Language":"English","Location of farmer":"Kasese","Question":"list effective vaccines farmers in kasese can use to vaccinate their pigs","Answer":"Farmers in Kasese can use several vaccines to safeguard their pigs against diseases like Furrowsure vaccine,Litterguard among others."},{"Category":"Animal","Subcategory":"pigs","Question_id":8264,"Language":"English","Location of farmer":"Kanungu","Question":"How can farmers in Kanungu ensure that the benefits of increased pig production are shared equitably?","Answer":"Farmers in Kanungu can achieve this through,Rearing improved pig breeds,carryout proper nutrition and ensure that their pigs are well housed . this will fooster increased production."},{"Category":"Animal","Subcategory":"pigs","Question_id":8311,"Language":"Luganda","Location of farmer":"Uganda","Question":"Ku ffaamu ye ey'embizzi , embizzi ezimu tezirabika nga za bulijjo era obubonero buzifunye nga muno mulimu omusujja, obutayagala mmere, okukoowa, n'okulumwa olususu. bulwadde ki bwe balina era ayinza atya okuziyiza nokufuga obulwadde obwengeri eno?.","Answer":"Obubonero obwo obwogedwaao ku faamu yo,mulunzi waffe bwoleeka nti embizzi ze  zezalamu (In breeding) era ekyok iziletera okuba ennaffu no kuba nga obulwadde tebuzigwaamu.Nolwekyo amagezi gemuwa ga kukyusa lulyo asobole okufunamu."},{"Category":"Animal","Subcategory":"pigs","Question_id":8365,"Language":"English","Location of farmer":"Kisoro","Question":"A farmer in Kisoro noticed that some pigs dont look normal and have got the signs which include fever, loss of appetite, lethargy, and skin lesions. W\\hich disease are they suffering from?","Answer":"The signs do reveal several shortcomings among which are in breeding,poor nutrition, worm infestation and mange infection among others."},{"Category":"Animal","Subcategory":"pigs","Question_id":8391,"Language":"Luganda","Location of farmer":"Kabale","Question":"okugema y'emu ku ngeri y'okufuga n'okuziyiza endwadde mu mbizzi, wandiika engeri endala gye tuyinza okufuga n'okuziyiza endwadde mu mbizzi e Kabale","Answer":"Engeri endala gyetuyinza okuziyiza endwadde eri mu kutta ebiwuka,okuziliisa emmere ettabudwa obulungi,okuzisuza mu nyumba enzimbe oburungi nokuziziyiza obutatukibwaako nsolo ezomunsiko nga tuteawo olukomela nobudiba mwetunyika ebigere nga tuyingira mudundiro."},{"Category":"Animal","Subcategory":"pigs","Question_id":8396,"Language":"Luganda","Location of farmer":"Masaka","Question":"Ndi mulunzi wa mbizzi e masaka , akatale kembizzi zange nkasanga wa ?","Answer":"Akatale ke mbizzi kali wona naye kisinzira ku lulyo ki lwolunda, nendabilira nga bino byebikuwa omutindo ogunakuwa akatale oba okukabuza."},{"Category":"Animal","Subcategory":"pigs","Question_id":8482,"Language":"English","Location of farmer":"Uganda","Question":"What are some other ways, in addition to deworming, through which pig farmers in Kisoro can increase pork production on their farms?","Answer":"There are several ways of increasing pig production apart from  deworming through  good feeding,proper breeding and sellection plus good husbandry practices."},{"Category":"Animal","Subcategory":"pigs","Question_id":8487,"Language":"English","Location of farmer":"Kanungu","Question":"In Kanungu, where African swine fever, pneumonia, and influenza are known to affect pigs, what are some other diseases that can also impact pigs in this region?","Answer":"Other diseases include,mange,worm infestation and nutritional diseases."},{"Category":"Animal","Subcategory":"pigs","Question_id":8488,"Language":"English","Location of farmer":"Kisoro","Question":"In Kisoro, where pork and manure are among the products obtained by pig farmers, what other products can a farmer expect to yield from pig farming?","Answer":"There are several products that can be derived from pig farming apart from manure and pork.These are blood meal,"},{"Category":"Animal","Subcategory":"pigs","Question_id":8628,"Language":"English","Location of farmer":"Uganda","Question":"Why is it necessary to isolate infected pigs, remove feces, and thoroughly clean pig sties with water and detergents on a farm?","Answer":"These measures help in controlling communicatable diseases."},{"Category":"Animal","Subcategory":"pigs","Question_id":8704,"Language":"English","Location of farmer":"Masaka","Question":"for a farmer in masaka, which two breeds of pigs can he rear that grow faster and are resistant to dieases?","Answer":"Crosses between large white and land race and cambrough."},{"Category":"Animal","Subcategory":"Pigs","Question_id":9906,"Language":"English","Location of farmer":"Ngora, Uganda","Question":"How is large white good in terms of production","Answer":"Large white is good to a certain extent but in terms of production its has limitations."}]
Owen = [{"Category":"Crop","Subcategory":"coffee","Question_id":3917,"Language":"English","Location of farmer":"Kaberamaido","Question":"Is coffee used as a drink only or there are other uses","Answer":"Coffee is mainly consumed as a beverage. Infact is one of the most widely consumned beverages in the world.  In Uganda for example, Coffee beans are eaten sometimes without roasting. However there are other products and by products from coffee. One of these products is caffeine which is a by product of decaffeination process. "},{"Category":"Crop","Subcategory":"coffee","Question_id":4029,"Language":"English","Location of farmer":"Masaka","Question":"How can the black coffee twig borer be controlled","Answer":"The Black coffee twig borer is one of the major pests for coffee especially Robusta coffee. The pest can be controlled using integrated pest mamanagement (IPM) technicques and practices ie a combincation of cultural, biolofgical and chemical methods. Cultural methods include; Phytosanitary cleanliness cutting affected plant parts and burning them. Eliminate alternative hosts tree species such as Musizi and Musambya\nCarry out regular inspection of fields to identify any black coffee twig borer infestation \nAvoid bushiness by planting at recommended spacing and doing adequate de-suckering and pruning of coffee and shade trees. Use of traps such as the NARO Beetle Trap Technology (consult your nearest extention agent to show you how to make and use the trap by yourself)\n\nPesticides can be used as the last line of defense in cases of heavy infestation. Spray with systemic pesticides such as  Immidacloprid or\/and Tebuconazole. Remember to always wear protective gears and take precaution while handling chemicals. \n\nBCTB can also be controled using biological control agents (natural enemies) such as Beauveria bassiana, Metarhizium anisopliae, a braconid wasp Plagiolepsis spp and Predator ant. However, these biological agents are not commercially available in Uganda. \n\n"},{"Category":"Crop","Subcategory":"coffee","Question_id":4083,"Language":"English","Location of farmer":"Kabale","Question":"what is the best fungicide for Robusta coffee in Kabale","Answer":"Choice of fungicides depends on the type of fungal disease you intend to control. For example in case of coffee leaf rust you can use Orius or copper-based fungicides. Remember to always exercise caution while using chemicals."},{"Category":"Crop","Subcategory":"coffee","Question_id":4144,"Language":"English","Location of farmer":"Ntungamo","Question":"where can I process coffee from in ntungamo","Answer":"There are quie a number coffee processors in Ntugamo district. Most of these do primary coffee proessing. One of them is Mpororo coffee factory located in Ntugamo town."},{"Category":"Crop","Subcategory":"coffee","Question_id":4188,"Language":"English","Location of farmer":"Kayunga","Question":"what is the best way to cut old stems when stumping a coffee tree?","Answer":"Stumping is the process of cutting cutting\ndown elderly and unproductive stems as a way of rehabilitating coffee plantations. Stumping is done using a pruning or bow saw to cut the coffee stems at a height of 6 inches (0.5ft) from the ground, at 45 degrees slanting slope to allow water to run off and prevent stump rotting. It is not recommended to cut all the stems. You should identify one healthy stem to remain as a feeder to continue feeding the stump until dormant buds open up into grown shoots (suckers).\nAlways disinfect the pruning tools using 90% ethanol, 25% diluted jik or methylated spirit before starting the stumping process, after cutting the previous tree before moving to the next tree and at the end of the day\u2019s pruning activity to prevent spread of diseases from tree to another.\n"},{"Category":"Crop","Subcategory":"Coffee","Question_id":4210,"Language":"English","Location of farmer":"Uganda","Question":"What are the disadvantages of using inorganic fertilizer in the farm","Answer":"Inorganic fertilisers or synthetic\/artificial fetilisers have advantages and disadvantages.\n \u2022 Due to their synthetic nature, inorganic fertilisers do not add organic manure to the soil\n \u2022 Inorganic fertilisers are more expensive than organic fertilisers\n \u2022 They may contain ingredients that may be toxic to the skin or respiratory system. Always use protective wear while applying inorganic fertilisers \n\u2022 Inorganic fertilisers residues can build up in the soil, causing long-term imbalances in soil pH and fertility \n\u2022 They are more susceptible to leaching hence being lost to the deeper layers of the soil profile.\n\n"},{"Category":"Crop","Subcategory":"Coffee","Question_id":4268,"Language":"English","Location of farmer":"Ngora","Question":"How many types of coffee do we have in Uganda","Answer":"There are two major coffee species grown commercially in Uganda. That is Arabica and Robusta. However, there are other indiginious species such as  Coffea liberica commonly known as kisansa. It is imprtant to know that there are several varieities under each of the species. For example, Ruiru, SL 14 and Nyasaland are varieties of Arabica coffee specie whereas KR1-10 are robusta coffee varieties "},{"Category":"Crop","Subcategory":"coffee","Question_id":4241,"Language":"English","Location of farmer":"mayuge district","Question":"How can grass Hopper destroy coffee around mayuge district","Answer":"Grass hoppers generally destroy crops by feeding on the leaves. Leaves are important for phosynthesis so if they are lost or damaged, the plant will struggle to surive.  \n "},{"Category":"Crop","Subcategory":"Coffee","Question_id":4245,"Language":"English","Location of farmer":"Ngora","Question":"What type of soil does coffee require for proper growth.","Answer":"Coffee can grow on different soil types in Uganda. Coffee performs well in fertile, well aerated, well drained, slightly acidic (pH range of 5.5 \u2013 6.5), deep soil with reasonable organic matter content and a minimum depth of 1-1.5m in well moist and 3m in drier areas. Coffee does not tolerate water logged soils or heavy clay soils. Consult an agriculture expert to do soil testing and recommend appropriate soil amendments suitable for coffee farming."},{"Category":"Crop","Subcategory":"Coffee","Question_id":4247,"Language":"English","Location of farmer":"Ngora","Question":"Which variety of coffee is highly needed in the market?","Answer":"Varieties of Arabica coffee have more demand worldwide because of superioir cup quality. "},{"Category":"Crop","Subcategory":"Coffee","Question_id":4236,"Language":"English","Location of farmer":"mayuge district","Question":"where can I find market for my coffee around mayuge district","Answer":"Contact your extension worker, district production officer, fellow farmers on market linkages for coffee. Uganda Coffee Development Authority (UCDA) has a list of certified exporters of coffee and also ussually posts prices of coffee on their website. "},{"Category":"Crop","Subcategory":"Coffee","Question_id":4290,"Language":"English","Location of farmer":"Kabale","Question":"8. What causes coffee leaf rust in coffee plantation?","Answer":"Coffee leaf rust is one of the most econmically important diseases of coffee espceially in Arabica coffee. It is caused by a fungi called Himeleiria vasatrix. "},{"Category":"Crop","Subcategory":"Coffee","Question_id":4289,"Language":"English","Location of farmer":"Kabale","Question":"How can diseases that affect coffee can be controlled in the field","Answer":"Diseases in coffee can be controled through many ways such Cultural methods which emphasises on good farming practices eg proper pruning and chemical methods where organic and inorganic products are used to control particular disease causing pathogens in coffee"},{"Category":"Crop","Subcategory":"Coffee","Question_id":4336,"Language":"English","Location of farmer":"Kabale","Question":"Arabica and Robusta coffee","Answer":"Arabica and Robusta are the major species of coffee grown worldwide. Arabica coffee thrives well at higher altitudes compared to Robusta coffee. In Uganda, Arabica coffee is mostly grown in the highlands of Bugisu, Sebei, Kigezi, Rwenzori and West nile whereas Robusta is usually grown in lowlands eg central Uganda. \n\nOn the farm, Robusta coffee is more bushy (has more leaves) compared to Arabica.\nIn the cup, Arabica is renowned for its superior cup taste and lower caffeine content. On the other hand Robusta beans produce a somewhat bitter brew with higher caffeine content. Ugandan Robusta has a reputation for its high quality and is usually used in blends to enhance the body and taste of Arabica coffee.\n\nAs a farmer, it is important to put in consideration the altitude of your farm before choosing to grow Robusta or Arabica coffee. \n"},{"Category":"Crop","Subcategory":"Coffee","Question_id":4337,"Language":"English","Location of farmer":"Kabale","Question":"2. What are the ecological requirements for growing Arabic coffee?","Answer":"Arabica coffee thrives well on high altitudes between 1,200-2,500m above sea level. Areas with such altitude and climate conditions in Uganda are; on the slopes of Mt Elgon in the East, Mt. Rwenzori in the\nWest and Mt. Muhabura in the South Western Region,\nOkoro highlands in West Nile plus other highland areas."},{"Category":"Crop","Subcategory":"Coffee","Question_id":4474,"Language":"English","Location of farmer":"Uganda","Question":"Is it ideal for a farmer to practice rotational grazing on his goats farming?","Answer":"Rotational grazing is the practice of feeding animals from one pasture plot to another at a time\nThe benefits of rotational goat grazing include better grass resource utilization, prevention of overgrazing, and promotion of normal development and growth of livestock. However, implementing a rotational grazing system requires additional land and fencing than continuous grazing.\n"},{"Category":"Crop","Subcategory":"coffee","Question_id":4581,"Language":"English","Location of farmer":"kayunga","Question":"Is it good to kill all parasites and predators in coffee trees?","Answer":"One of the principles of Integrated Pest Management (IPM) is to reduce pest population to acceptable levels. IPM uses combined strategies instead of one method to control a pest problem while minimising ecosystemm disruotion.   Much as it is good to eliminate a pest completely, it should be done without relying only on pesticides because it can cause pests to develop resistance to the pesticides. This might cause outbreaks of other pests, and can also kill non-target organisms. "},{"Category":"Crop","Subcategory":"Coffee","Question_id":4559,"Language":"English","Location of farmer":"KAYUNGA","Question":"Can we use Dursbun to spray on scales on coffee plants?","Answer":"Dursban can be used to control scales on coffee trees. Spot spray or apply a band of 700ml Dursban 48% E.C. in 20 litres of water witth 15 grams of methylene blue."},{"Category":"Crop","Subcategory":"coffee","Question_id":4582,"Language":"English","Location of farmer":"kayunga","Question":"How can we control the coffee Berry Borer?","Answer":"The coffee berry borerer (CBB) is one of the most devasitating pests of coffee. The adult male borers into green coffee cherry and lays eggs inside. An integrated pest management strategy is advised for use against CBB. The principal tactics are cultural control, biological control (using natural enemies of CBB), use of traps baited with attractants and chemical control with pesticides.\nCultural Control methods include; Pruning the coffee and shade trees to reduce shade exposes the pest so that the natural enemies can contain it. Remove coffee cherries that drop in the plantation as they habour coffee berry borer during off season.\nIf it warants to use chemicals; Spray with Fenitrothion 50% EC at a rate of 6ml in 4.5L of water applied at early fruit set (2mm cherry sizes) and later 120-150 days after fruit set if required. Farmers can also use Cypermethrin and Deltamethrin, pyrethroids (0.01%) at 26ml in 15L of water, or Chlorpyrifos ethyl used at 5mls per litre of water.  While handling chemicals, farmers are advised to strictly follow safe chemical use procedures.\n"},{"Category":"Crop","Subcategory":"Coffee","Question_id":4333,"Language":"Luganda","Location of farmer":"kyankwanzi district","Question":"Nga tusimba emmwanyi n'ekigimusa kya DAP tulina kuteekamu bungi ki mu kinnya?","Answer":"Bwooba osimba emwaanyi osobola okuteka grams 200 - 250 eza DAP mukinya. Wabula tugubagiza abalimi okukozesa Nakavundira mukifo kyokukozesa DAP yekka. Bwooba nga osimba emwaanyi, tabula ekigimusa bulungi netaka omale olizeemu mukinya nag tonasimba nsigo. "},{"Category":"Crop","Subcategory":"Coffee","Question_id":4271,"Language":"English","Location of farmer":"Ngora!","Question":"Which pesticides are good for spraying coffee?","Answer":"Pesticides can help in controlling pests in coffee plantations. There are different recomendations for particlar pests. Care should be taken to understand the pest and then chose an appropriate pestcide. For example; Imidacloprid is recommended for use against black coffe twig borer. Consult an agroculture extension work to advise you before buying a pesticide. "},{"Category":"Crop","Subcategory":"Coffee","Question_id":4383,"Language":"English","Location of farmer":"Uganda","Question":"What are the advantages of growing coffee to a farmer in Uganda?","Answer":"Coffee is not an intensive crop to grow. IBeing a perenial crop, it can provide income to a household for many years if well taken care of. It also has a readliy available market and stable prices. "},{"Category":"Crop","Subcategory":"Coffee","Question_id":4563,"Language":"English","Location of farmer":"KAYUNGA","Question":"by proper preparation of the soil","Answer":"Question not clear"},{"Category":"Crop","Subcategory":"coffee","Question_id":8312,"Language":"English","Location of farmer":"Uganda","Question":"What distinguishes Arabica beans from Robusta beans, apart from their cost and yield differences?","Answer":"Arabica and Robusta beans differ in many ways. Physically, Arabica beans are more oval and have a somewhat curved cleft whereas robusta beans are round with a somewhat straight cleft. Inside the bean, Robusta contains twice as much caffeine compared to Arabica.  "},{"Category":"Crop","Subcategory":"coffee","Question_id":8352,"Language":"English","Location of farmer":"Rwenzori Mountains","Question":"In Uganda, Rwenzori Mountains are known for leading coffee production in the country and Isingiro for matooke production. What district is known for maize production?","Answer":"It is true that farmers in the Rwenzori subregion grow coffee but they are not the leading producers. It is also true that Isingiro produces quite a lot of matooke. For the case of maize, I do not have access to production data by district but according to Uganda Beaureu of Statistics Annual Agricultural Survey (AAS) of 2019, Lake Victoria Cresent Agroecological Zone accounted for 20 - 50% of maize production in Uganda."},{"Category":"Crop","Subcategory":"Coffee","Question_id":11117,"Language":"English","Location of farmer":"Mbarara","Question":"How do I manage pests like coffee berry borer or diseases like coffee leaf rust effectively?","Answer":"The coffee berry borerer (CBB) is one of the most devasitating pests of coffee. The adult male borers into green coffee cherry and lays eggs inside. An integrated pest management strategy is advised for use against CBB. The principal tactics are cultural control, biological control (using natural enemies of CBB), use of traps baited with attractants and chemical control with pesticides. \nCultural Control methods include; Pruning the coffee and shade trees to reduce shade exposes the pest so that the natural enemies can contain it. Remove coffee cherries that drop in the plantation as they habour coffee berry borer during off season. \nIf it warants to use chemicals; Spray with Fenitrothion 50% EC at a rate of 6ml in 4.5L of water applied at early fruit set (2mm cherry sizes) and later 120-150 days after fruit set if required. Farmers can also use Cypermethrin and Deltamethrin, pyrethroids (0.01%) at 26ml in 15L of water, or Chlorpyrifos ethyl used at 5mls per litre of water. \n\nCoffee leaf rust is one of the most econmically important diseases of coffee espceially in Arabica coffee. It is caused by a fungi called Himeleiria vasatrix. Coffee leaf rust can be managed by good field management practices such as proper pruning and weeding. \n\nIf the infestation is severe, spray with Fungicides such as Orius . Copper based fungicides weekly starting at beginning of rainy season. Aim the spray nozzle at the lower side of the leaf for more effectiveness. If however 20% or more of the leaves are affected, the use of a systemic fungicide such as Triazole or Bayleton 25% EC, containing Triademefon, is recommended. Chemical use may not be economical for small scale farmers. While handling chemicals, farmers are advised to strictly follow safe chemical use procedures. \n\n\n"},{"Category":"Crop","Subcategory":"Coffee","Question_id":11118,"Language":"English","Location of farmer":"Mbarara","Question":"Can you advise on the optimal pruning techniques and frequency for coffee plants?","Answer":"Pruning also known as de-suckering is the process of removing broken, dead, unproductive, aged, diseased and pest damaged stems. It is an essential task for maintaining strong and healthy coffee trees.\nPruning is best carried out at the end of the main crop harvest every year. Proper pruning can be done as follows; \n\n\u2022 Use a pruning bow saw, sharp secateurs or a pruning saw for removing unwanted shoots of coffee trees. Ensure that the tools are cleaned using 75% ethanol, spirit or 25% dilution of Jik before, during and after use to prevent spreading disease from tree to tree. \n\u2022 Aim at keeping the number of stems to 3-4 stems for optimum productivity.\n\u2022 Remove all suckers that are not well positioned, secondary and tertiary branches that are not healthy\/strong or vibrant to enough give good crop yields.\n\u2022 When there are many suckers, the coffee plant will not be able to feed all of them sufficiently. Remove the weaker lower primaries and keep the vigorous upper primaries.\n\u2022 Removing suckers (de-suckering) can be done several times during the year depending on the amount and distribution of rainfall. Keep only the good branches so that they will optimize nutrients from the soil and receive enough light to give good yields and quality cherry.\n\u2022 Branches that are close to the ground must also be removed as they can be a conduit for pests and diseases infection. Prune off any diseased branches at the site (in-situ) and not dragged through the farm as this can easily lead to the spread of diseases such as\nCoffee Wilt Disease (CWD). \n\n"},{"Category":"Crop","Subcategory":"Coffee","Question_id":11796,"Language":"English","Location of farmer":"Mbarara","Question":"What is the recommended spacing of coffee trees at the plantation?","Answer":"The recommended spacing for robusta coffee in Uganda is 10 by 10 feet. For arabica coffee it is 8 by 8 feet apart. "},{"Category":"Crop","Subcategory":"Coffee","Question_id":11802,"Language":"English","Location of farmer":"Mbarara","Question":"What causes drooping in coffee plants?","Answer":"Drooping in coffee can be caused by water stress, diseases or nutrient defiencies but mostlikey water stress"},{"Category":"Crop","Subcategory":"Coffee","Question_id":11803,"Language":"English","Location of farmer":"Mbarara","Question":"Is it necessary to plant different breeds of coffee on the same land as a strategy to fight diseases?","Answer":"It is recomended to plant disease tolerant and resistant varieites. Some disease resistant include; Coffee wilt disease resistant varieties (KR 1-10) from the National Agricultural Research Organisation (NARO)-NaCORI "},{"Category":"Crop","Subcategory":"Coffee","Question_id":11807,"Language":"English","Location of farmer":"Butambala","Question":"We heard about a program that provides like insurance to farmers in case of a disaster or bad weather, what is it called, and how can I join?","Answer":"Agricultural Insurance is a relatively new phonomena in Uganda. The agro insurance efforts are being promoted under a public-private partnership between the Government of Uganda and farmers and select insurance companies. it is aimed at\nmitigating nancial losses suffered by farmers as a result of damage and destruction of their crops and livestock due to Fire, Drought, Flooding, Landslides, Hailstorm damage, Windstorm damage, Malicious damage,\nRiots & strikes and uncontrollable pests and diseases.\n Companies offering agro insurance inclue; APA Insurance (Uganda) Ltd, CIC General Insurance Uganda Ltd, First Insurance Company, Goldstar Insurance Company Ltd, Jubilee insurance, Lion Assurance, NIC General Insurance company Ltd, PAX Insurance, Phoenix of Uganda Assurance Company Ltd and UAP Insurance Uganda Ltd. Contact one of these companies for more information."},{"Category":"Crop","Subcategory":"Coffee","Question_id":11808,"Language":"English","Location of farmer":"Butambala","Question":"Apart from naads what other program gives out free coffee seedlings?","Answer":"The NAADS in conjuction with OWC supplied coffee seedling to specifc farmers. I am not aware of other organisations that give out free coffee seedlings currently. "},{"Category":"Crop","Subcategory":"Coffee","Question_id":11846,"Language":"English","Location of farmer":"Masaka","Question":"What name of a disease is given to when a coffee plant tip dries","Answer":"Coffee wilt diseases causes wilting starting from the tip of the plant also known as 'die back'"}]

list_of_expertiz = {
	'AgnesNamulindwa': {'id': 180},'FranciBalinda': {'id': 133},
	'GodfreySeruwu': {'id': 183},'IanBenya': {'id': 200},
	'JacklineAol': {'id': 146},'JanetNkozire': {'id': 134},
	'RichardLumu': {'id': 182}, 'Owen': {'id': 204},
}

derek_list = {'AgnesNamulindwa': AgnesNamulindwa,'FranciBalinda': FranciBalinda,
	'GodfreySeruwu': GodfreySeruwu,'IanBenya': IanBenya,
	'JacklineAol': JacklineAol,'JanetNkozire': JanetNkozire,
	'RichardLumu': RichardLumu, 'Owen': Owen
}

import json

from app.status import (
	HTTP_200_OK,
	HTTP_201_CREATED,
	HTTP_204_NO_CONTENT,
	HTTP_400_BAD_REQUEST,
	HTTP_404_NOT_FOUND,
	HTTP_409_CONFLICT,
)
from flask import Blueprint, request, send_file
from flask.json import jsonify
import pandas as pd
from flask_jwt_extended import get_jwt_identity, jwt_required, verify_jwt_in_request
from app.models import Question, db, User, Answer
import datetime
import random
import os
from os.path import join, dirname, realpath
from io import StringIO
from google.cloud import storage

from sqlalchemy import func, or_, and_, not_, text
from app.helper import admin_required

UPLOADS_PATH = join(dirname(realpath(__file__)), "static/audio_uploads")
DATASET_PATH = join(dirname(realpath(__file__)), "static/dataset")

questions = Blueprint("questions", __name__, url_prefix="/api/v1/questions")

def get_audio_file_content(file_path):
	# file_path = os.path.join(UPLOADS_PATH, filename)
	return send_file(file_path, as_attachment=True)



def format_question(question, language):
	return {
		"id": question.id,
		"sentence": question.sentence,
		"language": question.language,
		"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
		"topics": question.topic,
		"sub_topic": question.sub_topic,
		"category": question.category,
		"animal_crop": question.animal_crop,
		"location": question.location,
		"question_language": language,
		"filename": question.filename,
	}

def jsonify_question(question):
	return {
		"id": question.id,
		"sentence": question.sentence,
		"language": question.language,
		"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
		"topics": question.topic,
		"sub_topic": question.sub_topic,
		"category": question.category,
		"animal_crop": question.animal_crop,
		"location": question.location,
		"filename": question.filename,
		"reviewed": question.reviewed,
		"answered": question.answered
	}

def file_name(file):
	name = file.filename
	file_name, file_extension = os.path.splitext(name)
	return file_name, file_extension

def chanelle(value):
	if int(value) == 6:
		return 5
	try:
		return int(value)
	except ValueError:
		return 1

@questions.route("/", methods=["POST", "GET"])
@jwt_required()
def handle_questions():
	def process_single_question(question_data, current_user):
		sentence = question_data.get("sentence", "")
		language = question_data.get("language", "")
		topic = question_data.get("topic", "")
		sub_topic = question_data.get("sub_topics", "")
		category = question_data.get("category", "")
		animal_crop = question_data.get("sub_category", "")
		location = question_data.get("location", "")
		today = datetime.date.today()

		if language not in ["English", "Luganda", "Runyankole"]:
			return (
				jsonify({"error": "Invalid language selection"}),
				HTTP_400_BAD_REQUEST,
			)

		if not sentence or not language:
			return (
				jsonify(
					{
						"error": "Both sentence and language must be provided for each question"
					}
				),
				HTTP_400_BAD_REQUEST,
			)

		elif Question.query.filter_by(sentence=sentence).first():
			return (
				jsonify({"error": "This question already exists"}),
				HTTP_409_CONFLICT,
			)
		else:
			question = Question(
				sentence=sentence,
				language=language,
				user_id=current_user,
				topic=topic,
				category=category,
				animal_crop=animal_crop,
				location=location,
				sub_topic=sub_topic,
			)
			db.session.add(question)
			db.session.flush()

			num_questions = Question.query.filter_by(user_id=current_user).count()
			today = datetime.date.today()
			questions = (
				Question.query.filter_by(user_id=current_user)
				.filter(func.date(Question.created_at) == today)
				.all()
			)
			todaysQuestions = []
			for question in questions:
				todaysQuestions.append(
					{
						"id": question.id,
						"sentence": question.sentence,
						"language": question.language,
						"created_at": question.created_at,
						"topics": question.topic,
						"sub_topic": question.sub_topic,
						"category": question.category,
						"animal_crop": question.animal_crop,
						"location": question.location,
					}
				)

			return {
				"num_questions": num_questions,
				"questions": todaysQuestions,
			}, HTTP_201_CREATED

	current_user = get_jwt_identity()

	if request.method == "POST":
		data = request.get_json()

		if not data:
			return (
				jsonify({"error": "Invalid or empty JSON data provided"}),
				HTTP_400_BAD_REQUEST,
			)

		if isinstance(data, list): 
			results = []
			for question_data in data:
				result = process_single_question(question_data, current_user)
				results.append(result)
			db.session.commit()
			return jsonify(results), HTTP_201_CREATED
		else:  # If it's a single question
			result = process_single_question(data, current_user)
			db.session.commit()
			return result

	else:
		user = User.query.filter_by(id=current_user).first()
		if user:
			questions = user.questions

			returned_data = []

			if not questions:
				return jsonify({"error": "No data yet"}), HTTP_204_NO_CONTENT

			for question in questions:
				returned_data.append(
					{
						"id": question.id,
						"sentence": question.sentence,
						"language": question.language,
						"created_at": question.created_at,
						"topics": question.topic,
						"sub_topic": question.sub_topic,
						"category": question.category,
						"animal_crop": question.animal_crop,
						"location": question.location,
					}
				)

			return jsonify(returned_data), HTTP_200_OK
		else:
			return jsonify({"error": "User not found"}), HTTP_404_NOT_FOUND


@questions.route("/upload_question", methods=["POST"])
@jwt_required()
def upload_question():
	if "audio" not in request.files:
		return jsonify({"error": "No audio file provided"}), HTTP_400_BAD_REQUEST

	language = request.form.get("language")
	topic = request.form.get("topic", "")
	sub_topic = request.form.get("sub_topics", "")
	category = request.form.get("category", "")
	animal_crop = request.form.get("sub_category", "")
	location = request.form.get("location", "")

	audio = request.files["audio"]

	if audio:
		filename = os.path.join("static", "audio_uploads", audio.filename)
		if os.path.exists(filename):
			return jsonify({"Error": "File with same name already exists"})
		audio.save(filename)

	current_user = get_jwt_identity()
	question = Question(
		language=language,
		user_id=current_user,
		topic=topic,
		sub_topic=sub_topic,
		filename=filename,
		category=category,
		animal_crop=animal_crop,
		location=location,
	)

	db.session.add(question)
	db.session.flush()

	num_questions = Question.query.filter_by(user_id=current_user).count()
	today = datetime.date.today()
	questions = (
		Question.query.filter_by(user_id=current_user)
		.filter(func.date(Question.created_at) == today)
		.all()
	)
	todaysQuestions = []
	for question in questions:
		todaysQuestions.append(
			{
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at,
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
				"filename": question.filename
			}
		)

	return {
		"num_questions": num_questions,
		"questions": todaysQuestions,
	}, HTTP_201_CREATED


@questions.route("/offline_upload", methods=["POST"])
@jwt_required()
def offline_upload():
	if "file" not in request.files:
		return jsonify({"error": "No metadata file provided"}), HTTP_400_BAD_REQUEST

	if "files" not in request.files:
		return jsonify({"error": "No audio files provided"}), HTTP_400_BAD_REQUEST

	metadata_file = request.files.get("file")
	audio_files = request.files.getlist("files")
	metadata = json.loads(metadata_file.read().decode("utf-8"))

	if not audio_files:
		return jsonify({"error": "No audio files provided"}), HTTP_400_BAD_REQUEST

	if not metadata:
		return jsonify({"error": "Metadata file not provided"}), HTTP_400_BAD_REQUEST

	current_user = get_jwt_identity()

	questions = []
	dup_count = 0
	duplicates = []

	for obj in metadata:
		audio_filename = obj['audio_filePath'].rsplit('.', 1)[0]
		
		for audio in audio_files:
			au  =  file_name(audio)[0]
			
			if audio_filename == au:
				
				filename = os.path.join("static", "audio_uploads", obj["audio_filename"])

				if os.path.exists(filename):
					dup_count += 1
					duplicates.append({"filename": filename})
					return (
						jsonify({"error": "File with the same name already exists"}),
						HTTP_400_BAD_REQUEST,
					)
				audio.save(filename) 		

				if obj:
					question_data = {
						"language": obj.get("language"),
						"topic": obj.get("topic", ""),
						"sub_topic": obj.get("sub_topics", ""),
						"category": obj.get("category", ""),
						"animal_crop": obj.get("sub_category", ""),
						"location": obj.get("location", ""),
						"user_id": current_user,
						"filename": filename,
					}

					question = Question(**question_data)
					questions.append(question)
				else:
					return (
						jsonify(
							{"error": f"No metadata found for audio file: {audio.filename}"}
						),
						HTTP_400_BAD_REQUEST,
					)

	db.session.add_all(questions)
	db.session.commit()

	num_questions = Question.query.filter_by(user_id=current_user).count()
	return (
		jsonify(
			{
				"num_questions": num_questions,
				"duplicate_questions": dup_count,
				"duplicates": duplicates,
			}
		),
		HTTP_200_OK,
	)


@questions.route("/file_upload/", methods=["POST"])
@jwt_required()
def upload_json_file():
	if request.method == "POST":
		file_json = request.files.get("file")
		json_data = json.load(file_json)

		current_user = get_jwt_identity()
		dup_count = 0
		duplicates = []

		for obj in json_data:
			sentence = obj["sentence"]
			language = obj["language"]
			topic = obj.get("topic")
			sub_topic = obj.get("sub_topics")
			category = obj.get("category")
			animal_crop = obj.get("sub_category")
			location = obj.get("location")

			if Question.query.filter_by(sentence=sentence).first():
				dup_count += 1
				duplicates.append({"sentence": sentence})
			else:
				question = Question(
					sentence=sentence,
					language=language,
					user_id=current_user,
					topic=topic,
					sub_topic=sub_topic,
					category=category,
					animal_crop=animal_crop,
					location=location,
				)
				db.session.add(question)
				db.session.commit()

		num_questions = Question.query.filter_by(user_id=current_user).count()

		return (
			jsonify(
				{
					"num_questions": num_questions,
					"duplicate_questions": dup_count,
					"duplicates": duplicates,
				}
			),
			HTTP_200_OK,
		)


@questions.get("/<int:id>")
@jwt_required()
def get_question(id):
	current_user = get_jwt_identity()

	question = Question.query.filter_by(user_id=current_user, id=id).first()

	if not question:
		return jsonify({"message": "Question not found"}), HTTP_404_NOT_FOUND

	return (
		jsonify(
			{
				"id": question.id,
				"language": question.language,
				"sentence": question.sentence,
				"created_at": question.created_at,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
			}
		),
		HTTP_200_OK,
	)

@jwt_required()
@questions.get('/delete-questions')
def delete_questions():
	try:
		questions_to_delete = Question.query.filter(Question.rephrased == "actual", Question.reviewed != True).all()
		
		# for question in questions_to_delete:
		#		Answer.query.filter_by(question_id=question.id).delete()

		# num_deleted = Question.query.filter(Question.rephrased == "actual", Question.reviewed != True).delete()
		num_deleted = len(questions_to_delete)

		db.session.commit()
		return jsonify({'message': f'{num_deleted} questions and associated answers deleted successfully'})
	except Exception as e:
		db.session.rollback()
		return jsonify({'error': 'An error occurred while deleting questions and answers'})


@jwt_required()
@questions.get("/displayall")
def display_questions():
	verify_jwt_in_request()
	curre = get_jwt_identity()
	isadmin = User.query.get(curre)
	page = request.args.get('page', 1, type=int)
	per_page = request.args.get('per_page', 100, type=int)
	questions = Question.query.filter(
		(Question.user_id != isadmin.id)
	).paginate(page=page, per_page=per_page, error_out=False)

	if not questions:
		return jsonify({"message": "No questions yet."}), HTTP_204_NO_CONTENT

	returned_data = []

	for question in questions:
		user = User.query.get(question.user_id)  # Get the user who asked the question
		if user:
			user_name = f"{user.firstname} {user.lastname}"

		returned_data.append(
			{
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
				"audio": question.filename,
				"user_name": user_name,
			}
		)

	return jsonify(returned_data), HTTP_200_OK


@jwt_required()
@questions.get("/all")
def get_questions():
	current_user = get_jwt_identity()
	isadmin = User.query.get(current_user)
	questions = Question.query.filter(
		(Question.user_id != isadmin.id)
	).all()

	if not questions:
		return jsonify({"message": "No questions yet."}), HTTP_204_NO_CONTENT

	returned_data = []

	for question in questions:
		user = User.query.get(question.user_id)
		if user:
			user_name = f"{user.firstname} {user.lastname}"

		returned_data.append(
			{
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
				"audio": question.filename,
				"user_name": user_name,
			}
		)

	return jsonify(returned_data), HTTP_200_OK



@jwt_required()
@questions.get("/download")
def download_questions():
	verify_jwt_in_request()
	user_id = get_jwt_identity()
	isadmin = User.query.get(user_id)
	start_date_str = request.args.get('start_date')
	
	if start_date_str:
		try:
			start_date = datetime.datetime.strptime(start_date_str, '%Y-%m-%d')
			questions = Question.query.filter(
				(Question.user_id != isadmin.id) &
				(Question.created_at >= start_date)
			).all()
		except ValueError:
			return jsonify({"message": "Invalid start_date format. Use YYYY-MM-DD."}), HTTP_400_BAD_REQUEST
	else:
		questions = Question.query.filter(
			(Question.rephrased != "actual")
		).all()

	if not questions:
		return jsonify({"message": "No questions yet."}), HTTP_204_NO_CONTENT

	returned_data = []

	for question in questions:
		user = User.query.get(question.user_id)  # Get the user who asked the question
		user_name = None
		if user:
			user_name = f"{user.firstname} {user.lastname}"

		returned_data.append(
			{
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
				"audio": question.filename,
				"user_name": user_name,
			}
		)
	return jsonify(returned_data), HTTP_200_OK

@jwt_required()
@questions.get("/myqns")
def get_my_questions():
	questions = Question.query.filter(
		(Question.rephrased == "actual")
	).all()

	if not questions:
		return jsonify({"message": "No questions yet."}), HTTP_204_NO_CONTENT

	returned_data = []

	for question in questions:
		user = User.query.get(question.user_id)
		if user:
			user_name = f"{user.firstname} {user.lastname}"

		returned_data.append(
			{
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
				"user_name": user_name,
				"reviewed":question.reviewed,
				"rephrased": question.rephrased
			}
		)

	return jsonify(returned_data), HTTP_200_OK

@jwt_required()
@questions.get("/top_users")
def top_users_with_most_questions():
	users_with_most_questions = (
		User.query.join(Question, User.id == Question.user_id)
		.group_by(User.id)
		.order_by(db.func.count(Question.id).desc())
		.all()
	)
	top_users_data = []
	for user in users_with_most_questions:
		top_users_data.append(
			{
				"user_id": user.id,
				"location": user.location,
				"firstname": user.firstname,
				"lastname": user.lastname,
				"username": user.username,
				"phone_number": user.phone_number,
				"total_questions": len(user.questions),
			}
		)

	return jsonify(top_users_data), HTTP_200_OK


@jwt_required()
@questions.get("/stats")
# @admin_required
def list_questions():
	verify_jwt_in_request()
	current_user = get_jwt_identity()
	isadmin = User.query.get(current_user)
	all_questions = Question.query.filter(
		(Question.user_id != isadmin.id)
	).all()
	
	#     all_questions = db.sessionQuestion).all()
	total_questions = len(all_questions)
	questions_per_language = (
		db.session.query(Question.language, func.count(Question.id))
		.filter((Question.user_id != isadmin.id))
		.group_by(Question.language)
		.all()
	)
	
	audio_questions = Question.query.filter(Question.filename.isnot(None)).all()

	average_daily_questions = total_questions / (
		Question.query.filter(
			(Question.rephrased != "actual"),
			(Question.user_id != isadmin.id)
			& (Question.created_at >= datetime.date.today())
		).count()
		or 1
	)

	one_week_ago = datetime.date.today() - datetime.timedelta(weeks=1)
	average_weekly_questions = total_questions / (
		Question.query.filter(
			(Question.rephrased != "actual"),
			(Question.user_id != isadmin.id)
			& (Question.created_at >= one_week_ago)
		).count()
		or 1
	)

	#  Calculate average questions per user
	total_users = User.query.count()
	average_questions_per_user = total_questions / (total_users or 1)
	
	plant_question_count = Question.query.filter(
		(Question.user_id != isadmin.id)
		& (func.lower(Question.category) == "crop")
	).count()

	animal_question_count = Question.query.filter(
		(Question.user_id != isadmin.id)
		& (func.lower(Question.category) == "animal")
	).count()

	response_data = {
		"total_questions": total_questions,
		"questions_per_language": [
			{"language": lang, "count": count} for lang, count in questions_per_language
		],
		"average_daily_questions": round(average_daily_questions, 2),
		"average_weekly_questions": round(average_weekly_questions, 2),
		"average_questions_per_user": round(average_questions_per_user, 2),
		"plant_category": plant_question_count,
		"animal_category": animal_question_count,
		"audios": len(audio_questions),
		"questions": [
			{
				"id": question.id,
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
			}
			for question in all_questions
		],
	}

	return jsonify(response_data), HTTP_200_OK


@questions.route("/random_question", methods=["GET"])
@jwt_required()
def random_question_and_add_answer():
	user_id = get_jwt_identity()
	random_question = (
		Question.query.filter(~Question.answers.any(Answer.source == "expert"))
		.order_by(db.func.random())
		.first()
	)

	if random_question:
		question_data = {
			"id": random_question.id,
			"sentence": random_question.sentence,
			"language": random_question.language,
			"created_at": random_question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
			"topics": random_question.topic,
			"sub_topic": random_question.sub_topic,
			"category": random_question.category,
			"animal_crop": random_question.animal_crop,
			"location": random_question.location,
		}
		return jsonify(question_data), HTTP_200_OK
	else:
		return jsonify({"message": "No questions available."}), HTTP_404_NOT_FOUND


@questions.route("/main_question_review", methods=["POST"])
@jwt_required()
def main_question_review():

	sub_category_map = {
    "poultry": ["chicken", "ducks", "guinea fowls", "turkeys"],
    "vegetables":  [
			"tomatoes", "carrots", "onions", "mushrooms", "eggplant", "beetroot",
			"doodo", "spinach", "cucumbers", "avocado", "cabbage", "nakati", "ginger",
			"green pepper", "garlic", "okra", "lettuce", "malakwang", "pepper", "sukuma wiiki",
			"kale", "hubiscus", "crops", "crop"
		],
		"cattle": ["cattle", "goat", "goats", "sheep"],
		"fish": ["fish", 'Fish'],
		"banana": ["banana", "bananas", "crop", "crops"],
		"fruits": ["watermelon", "pineapple", "mango", "sugarcane", "orange", "avocado", "passion fruit", "jack fruit", "paw paw", "guava", "lemon"],
		"cereals": ["maize", "sorghum", "millet", "rice", "wheat", "sim sim", "sesame"],
		"legumes": [ "soya beans", "beans", "peas", "groundnuts", "Gnuts", "ground nuts"],
		"piggery": ["pigs", 'animal', 'animals']
  }

	data = request.get_json()
	
	category = data.get("category", None)
	language = data.get("language", None)
	sub_category = data.get("sub_category", None)
	new_category = data.get("new_category", None)

	filters = []

	expert_id = get_jwt_identity()

	category_filter = func.lower(Question.category) == category
	answers_count = Answer.query.filter_by(user_id=expert_id).count()
	sub_categories = [sc.strip().lower() for sc in new_category.split(",")]

	if len(sub_categories) >= 3 and answers_count >= 350:
		return jsonify({"message":"You have answered enough questions. START ranking."}), HTTP_200_OK
	elif len(sub_categories) < 3 and answers_count >= 250:
		return jsonify({"message":"You have answered enough questions. START ranking."}), HTTP_200_OK
	else:
		if language:
			languages = [lang.strip().lower() for lang in language.split(",")]
			language_filter = func.lower(Question.language).in_(languages)
			filters.append(language_filter)

		if sub_category:
			sub_category_filters = []
			
			for sub_category_name in sub_categories:
				sub_category_list = sub_category_map.get(sub_category_name)
				if sub_category_list:
					sub_category_filters.append( func.lower(Question.animal_crop).in_(sub_category_list))
				else:
					sub_category_filters.append(func.lower(Question.animal_crop) == sub_category_name)
			
			if sub_category_filters:
				filters.append(or_(*sub_category_filters))

	matching_questions = (
		Question.query.filter(Question.rephrased == "actual", Question.answered.is_(False), *filters)
		.all()
	)

	if matching_questions:
		random_question = random.sample(matching_questions, 1)[0]
		questions_data = format_question(random_question, "Any Language")
		return jsonify([questions_data]), HTTP_200_OK
	else:
		return jsonify({"message": "No questions available."}), HTTP_404_NOT_FOUND


@jwt_required()
@questions.route("/main_question_answer", methods=["POST"])
def main_question_answer():
	data = request.get_json()

	category = (data.get("category", None)).title()
	language = data.get("language", None)
	sub_category = data.get("sub_category", None)
	new_category = data.get("new_category", None)
	filters = []
	if language:
		if ',' in language:
			languages = [lang.strip().lower() for lang in language.split(",")]
			language_filter = func.lower(Question.language).in_(languages)
		else:
			language_filter = func.lower(Question.language) == language.strip().lower()
		filters.append(language_filter)
	
	if sub_category:
		sub_category = sub_category.lower()
		if sub_category.lower() == "vegetables":
			
	
			allowed_vegetables = [
				"tomatoes", "carrots", "onions", "mushrooms", "eggplant", 
        "beetroot", "doodoo", "spinach", "cucumbers", "avocado", 
        "cabbage", "nakati", "ginger", "green pepper", "garlic", 
        "okra", "lettuce", "malakwang", "pepper"
				]
			if ',' in sub_category:
				sub_categories = [lang.strip().lower() for lang in sub_category.split(",")]
				sub_category_filter = func.lower(Question.animal_crop).in_(sub_categories)
				sub_category_filter = and_(sub_category_filter, func.lower(Question.animal_crop).in_(allowed_vegetables))
			else:
				sub_category_filter = func.lower(Question.animal_crop).in_(allowed_vegetables)
		else:
			if ',' in sub_category:
				sub_categories = [lang.strip().lower() for lang in sub_category.split(",")]
				sub_category_filter = func.lower(Question.animal_crop).in_(sub_categories)
			else:
				sub_category_filter = func.lower(Question.animal_crop) == sub_category.strip().lower()
		filters.append(sub_category_filter)


	matching_questions = Question.query.filter(
		Question.category.ilike(category),
		Question.rephrased == "actual",
    Question.reviewed == True,
    Question.answered.is_not(True),
		*filters
		).order_by(db.func.random()).first()

	if matching_questions is not None:
		return jsonify(jsonify_question(matching_questions)), HTTP_200_OK
	else:
		return jsonify({"message": "No questions available."}), HTTP_404_NOT_FOUND


@questions.post("/add_answer/<int:question_id>")
@jwt_required()
def add_answer(question_id):
	data = request.get_json()
	user_id = get_jwt_identity()
	answer_text = request.json["answer"].strip()

	question = Question.query.get(question_id)
	if not question:
		return jsonify({"message": "Question not found."}), HTTP_404_NOT_FOUND

	if answer_text and len(answer_text) > 7:
		new_answer = Answer(
			question_id=question_id,
			user_id=user_id,
			answer_text=answer_text,
			source="expert",
		)

		db.session.add(new_answer)
		question.answered = True
		question.answer_expert_one = user_id
		db.session.commit()

		return jsonify({"message": "Answer added successfully."}), HTTP_201_CREATED
	return jsonify({"message": "Failed to add answer."})

@questions.post("/review_and_answer/<int:question_id>")
@jwt_required()
def review_and_answer(question_id):
	user_id = get_jwt_identity()
	question = Question.query.get(question_id)

	if not question:
		return jsonify({"message": "Question not found."}), HTTP_404_NOT_FOUND

	data = request.get_json()
	answer_text = data.get("answer", "").strip()
	new_topic = data.get("topic")

	if answer_text and len(answer_text) > 4:
		new_answer = Answer(
				question_id=question_id,
				user_id=user_id,
				answer_text=answer_text,
				source="expert",
		)

		db.session.add(new_answer)
		question.answered = True
		question.answer_expert_one = user_id

		if question.topic:
			if new_topic:
				question.topic = (new_topic + ", " + question.topic)
		else:
			question.topic = new_topic

		question.reviewed = True
		question.correct = True
		question.reviewer_id = user_id

		db.session.commit()

		return jsonify({"message": "Answer added successfully and question attributes updated."}), HTTP_201_CREATED

	return jsonify({"message": "Failed to add answer or update question attributes."})

@questions.route("/incorrect/<int:question_id>", methods=["PUT"])
@jwt_required()
def mark_question_as_reviewed(question_id):
	user_id = get_jwt_identity()
	question = Question.query.get(question_id)

	if question:
		question.reviewed = True
		question.correct = False
		question.reviewer_id = user_id

		db.session.commit()

		return jsonify({"message": "Question attributes updated"})
	else:
		return jsonify({"message": "Question not found"})


@questions.route("/question_review/<int:question_id>", methods=["PATCH"])
@jwt_required()
def question_review(question_id):
	user_id = get_jwt_identity()
	question = Question.query.get(question_id)
	
	if question:

		question.reviewed = True
		question.correct = True 
		question.reviewer_id = user_id

		rephrased_data = request.json.get(
			"rephrased"
		)
		if rephrased_data:
			question.sentence = rephrased_data

		new_topic = request.json.get(
			"topic"
		)
		if question.topic:
			if new_topic:
				question.topic = (
					new_topic + ", " + question.topic
				)
		else:
			question.topic = new_topic 

		db.session.commit()

		return jsonify({"message": "Question attributes updated"})
	else:
		return jsonify({"message": "Question not found"})


@questions.route("/random_unanswered_question", methods=["GET"])
@jwt_required()
def get_random_unanswered_question():
	user_id = get_jwt_identity()

	# Get a random unanswered question for the user
	random_questions = Question.query.filter(
		Question.rephrased == "actual",
    Question.reviewed == True,
    Question.answered.is_not(True),
		Question.user_id == user_id
	).all()
	print(len(random_questions))
	questions_data = []
	if random_questions:
		for random_question in random_questions:
			question_data = {
				"id": random_question.id,
				"sentence": random_question.sentence,
				"language": random_question.language,
				"category": random_question.category,
				"sub_topic": random_question.animal_crop,
				"location": random_question.location,
				# "sub_topic": random_question.sub_topic,
			}
			questions_data.append(question_data)
		return jsonify(questions_data), 200
	else:
		return jsonify({"message": "No unanswered questions available"}), 404


@questions.route("/luganda", methods=["GET"])
@jwt_required()
def get_luganda_questions():
	luganda_questions = Question.query.filter(
		(Question.rephrased != "actual"),
		(Question.cleaned.is_(None) | (Question.cleaned != "t"))
		& (func.lower(Question.language) == "luganda")
	).all()

	if luganda_questions:
		questions_data = []
		for question in luganda_questions:
			question_data = {
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
				"cleaned": question.cleaned,
			}
			questions_data.append(question_data)

		return jsonify(questions_data), HTTP_200_OK
	else:
		return jsonify({"message": "No Luganda questions found"}), HTTP_404_NOT_FOUND


@questions.route("/english", methods=["GET"])
@jwt_required()
def get_english_questions():
	english_questions = Question.query.filter(
		(Question.rephrased != "actual"),
		(Question.cleaned.is_(None) | (Question.cleaned != "t"))
		& (func.lower(Question.language) == "english")
	).all()

	if english_questions:
		questions_data = []
		for question in english_questions:
			question_data = {
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
				"cleaned": question.cleaned,
			}
			questions_data.append(question_data)

		return jsonify(questions_data), HTTP_200_OK
	else:
		return jsonify({"message": "No Luganda questions found"}), HTTP_404_NOT_FOUND
	
@questions.route("/runyankole", methods=["GET"])
@jwt_required()
def get_runyankole_questions():
	verify_jwt_in_request()
	current_user = get_jwt_identity()
	is_admin = User.query.get(current_user)

	runya_questions = (Question.query
	.filter(Question.user_id != is_admin.id)
	.filter(func.lower(Question.language) == "runyankole")
	.all())


	if runya_questions:
		questions_data = []
		for question in runya_questions:
			question_data = {
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
				"cleaned": question.cleaned,
			}
			questions_data.append(question_data)

		return jsonify(questions_data), HTTP_200_OK
	else:
		return jsonify({"message": "No Runyankole questions found"}), HTTP_404_NOT_FOUND
	
@questions.route("/audios", methods=["GET"])
@jwt_required()
def audio_questions():
	
	audio_questions_list = []

	# for filename in allaudios:
	# 	question_detail = Question.query.filter(func.lower(Question.filename) == filename.lower()).first()

	# 	if question_detail:
	# 		user = User.query.get(question_detail.user_id)
	# 		if user:
	# 			user_name = f"{user.firstname} {user.lastname}"
     
	# 		audio_questions_list.append({
	# 			'id': question_detail.id,
	# 			"language": question_detail.language,
	# 			"created_at": question_detail.created_at.strftime("%Y-%m-%d %H:%M:%S"),
	# 			"topics": question_detail.topic,
	# 			"sub_topic": question_detail.sub_topic,
	# 			"category": question_detail.category,
	# 			"animal_crop": question_detail.animal_crop,
	# 			"location": question_detail.location,
	# 			'filename': question_detail.filename,
	# 			'username': user_name,
	# 			# 'file_content': get_audio_file_content(file_path)
	# 		})
	# 		print(len(audio_questions_list))
	# if len(audio_questions_list) > 0:
	# 	return jsonify(audio_questions_list)
	# else:
	return jsonify({"message": "No Audio questions found"}), HTTP_404_NOT_FOUND

@questions.route("/expertluganda", methods=["GET"])
@jwt_required()
def get_expert_luganda_questions():
	luganda_questions = Question.query.filter(
		(Question.rephrased == "actual")
		& (func.lower(Question.language) == "luganda")
	).all()

	if luganda_questions:
		questions_data = []
		for question in luganda_questions:
			question_data = {
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
			}
			questions_data.append(question_data)

		return jsonify(questions_data), HTTP_200_OK
	else:
		return jsonify({"message": "No Luganda expert questions found"}), HTTP_404_NOT_FOUND
	
@questions.route("/expertenglish", methods=["GET"])
@jwt_required()
def get_expert_english_questions():
	luganda_questions = Question.query.filter(
		(Question.rephrased == "actual")
		& (func.lower(Question.language) == "english")
	).all()

	if luganda_questions:
		questions_data = []
		for question in luganda_questions:
			question_data = {
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
			}
			questions_data.append(question_data)

		return jsonify(questions_data), HTTP_200_OK
	else:
		return jsonify({"message": "No English expert questions found"}), HTTP_404_NOT_FOUND
	
@questions.route("/expertrunyankole", methods=["GET"])
@jwt_required()
def get_expert_runyankole_questions():
	luganda_questions = Question.query.filter(
		(Question.rephrased == "actual")
		& (func.lower(Question.language) == "runyankole")
	).all()

	if luganda_questions:
		questions_data = []
		for question in luganda_questions:
			question_data = {
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				"topics": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
			}
			questions_data.append(question_data)

		return jsonify(questions_data), HTTP_200_OK
	else:
		return jsonify({"message": "No Runyankole expert questions found"}), HTTP_404_NOT_FOUND

@questions.route("/evaluated", methods=["GET"])
@jwt_required()
def get_evaluated_questions():
	
	matching_questions = (
		Question.query.filter(
			Question.ranking_count == 2)
		.all()
	)
	total_questions = len(matching_questions)
	print(total_questions)

	if matching_questions:
		questions_data = []
		for question in matching_questions:
			question_data = {
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"created_at": question.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				"topic": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
				"answers": []
			}

			for answer in question.answers:
				answer_data = {
					"id": answer.id,
					"answer_text": answer.answer_text,
					"source": answer.source,
					"relevance": answer.relevance,
					"coherence": answer.coherence,
					"fluency": answer.fluency,
					"context": answer.context,
					"created_at": answer.created_at.strftime("%Y-%m-%d %H:%M:%S"),
				}
				question_data["answers"].append(answer_data)

			questions_data.append(question_data)

		result_object = {
				"questions": questions_data,
				"total_questions": total_questions
		}
		print(len(question_data))
		return jsonify(result_object), HTTP_200_OK
	else:
		return jsonify({"message": "No questions available for ranking."}), HTTP_404_NOT_FOUND

@questions.route("/cleaning", methods=["GET"])
@jwt_required()
def clean_evaluated_questions():
	matching_questions = Question.query.filter(Question.ranking_count == 2).all()
	if matching_questions:
		for entry in matching_questions:
			for answer in entry.answers:
				if answer.relevance > 10:
					sum_of_digits = sum(int(digit) for digit in str(answer.relevance))
					answer.relevance = sum_of_digits
				if answer.coherence > 10:
					sum_of_digits = sum(int(digit) for digit in str(answer.coherence))
					answer.coherence = sum_of_digits
				if answer.fluency > 10:
					sum_of_digits = sum(int(digit) for digit in str(answer.fluency))
					answer.fluency = sum_of_digits
		db.session.commit()
		return jsonify({"message": "Values updated successfully."}), HTTP_200_OK
	else:
			return jsonify({"message": "No questions available for cleaning."}), HTTP_404_NOT_FOUND

@questions.route("/dataset_upload/", methods=["POST"])
@jwt_required()
def upload_excel_file():
	if request.method == "POST":
		file_excel = request.files.get("file")

		if file_excel and file_excel.filename.endswith(".xlsx"):
			try:
				# Read the Excel file using pandas
				df = pd.read_excel(file_excel)

				current_user = get_jwt_identity()
				dup_count = 0
				duplicates = []

				for _, row in df.iterrows():
					sentence = row.get("sentence")
					language = row.get("language")
					topic = row.get("topics", None)
					category = row.get("category", None)
					animal_crop = row.get("crop_animal", None)
					location = row.get("location", None)

					if Question.query.filter_by(sentence=sentence).first():
						dup_count += 1
						duplicates.append({"sentence": sentence})
					else:
						question = Question(
							sentence=sentence,
							language=language,
							user_id=current_user,
							topic=topic,
							category=category,
							animal_crop=animal_crop,
							location=location,
						)
						db.session.add(question)

				db.session.commit()

				num_questions = Question.query.filter_by(user_id=current_user).count()

				return (
					jsonify(
						{
							"num_questions": num_questions,
							"duplicate_questions": dup_count,
							"duplicates": duplicates,
						}
					),
					HTTP_200_OK,
				)
			except Exception as e:
				return jsonify({"message": str(e)}), HTTP_400_BAD_REQUEST
		else:
			return (
				jsonify(
					{"message": "Invalid file format. Please upload a .xlsx file."}
				),
				HTTP_400_BAD_REQUEST,
			)

@questions.route("/main_question_rank", methods=["POST"])
@jwt_required()
def main_question_rank():
	sub_category_map = {
    "poultry": ["chicken", "ducks", "guinea fowls", "turkeys"],
    "vegetables":  [
			"tomatoes", "carrots", "onions", "mushrooms", "eggplant", "beetroot",
			"doodo", "spinach", "cucumbers", "avocado", "cabbage", "nakati", "ginger",
			"green pepper", "garlic", "okra", "lettuce", "malakwang", "pepper", "sukuma wiiki",
			"kale", "hubiscus", "crops", "crop"
		],
		"cattle": ["cattle", "goat", "goats", "sheep"],
		"fish": ["fish", 'Fish'],
		"banana": ["banana", "bananas", "crop", "crops"],
		"fruits": ["watermelon", "pineapple", "mango", "sugarcane", "orange", "avocado", "passion fruit", "jack fruit", "paw paw", "guava", "lemon"],
		"cereals": ["maize", "sorghum", "millet", "rice", "wheat", "sim sim", "sesame"],
		"legumes": [ "soya beans", "beans", "peas", "groundnuts", "Gnuts", "ground nuts"],
		"piggery": ["pigs", 'animal', 'animals']
  }

	data = request.get_json()
	
	category = (data.get("category", None)).title()
	language = data.get("language", None)
	sub_category = data.get("sub_category", None)
	new_category = data.get("new_category", None)

	current_user = get_jwt_identity()

	filters = []
	random_question_data = None

	category_filter = func.lower(Question.category) == category

	if language:
		languages = [lang.strip().lower() for lang in language.split(",")]
		language_filter = func.lower(Question.language).in_(languages)
		filters.append(language_filter)

	if sub_category:
		sub_categories = [sc.strip().lower() for sc in new_category.split(",")]
		sub_category_filters = []
		
		for sub_category_name in sub_categories:
			sub_category_list = sub_category_map.get(sub_category_name)
			if sub_category_list:
				sub_category_filters.append( func.lower(Question.animal_crop).in_(sub_category_list))
			else:
				sub_category_filters.append(func.lower(Question.animal_crop) == sub_category_name)
		
		if sub_category_filters:
			filters.append(or_(*sub_category_filters))

	random_question = (
		Question.query.filter(
			Question.rephrased == "actual",
    	Question.answered.is_(True),
    	Question.finished.is_not(True),
			(~Question.answers.any(Answer.user_id == current_user)),
			Question.rank_expert_one != current_user,
			Question.ranking_count < 2,
			*filters)
		.all()
	)

	matching_questions = None
	if random_question:
		partial_ranked_qns = [q for q in random_question if q.ranking_count == 1]

		if partial_ranked_qns:
			matching_questions = random.sample(partial_ranked_qns, 1)[0]
		else:
			matching_questions = random.sample(random_question, 1)[0]
	
	if matching_questions:
		random_question_data = {
			"id": matching_questions.id,
			"sentence": matching_questions.sentence,
			"language": matching_questions.language,
			"created_at": matching_questions.created_at.strftime("%Y-%m-%d %H:%M:%S"),
			"topic": matching_questions.topic,
			"sub_topic": matching_questions.sub_topic,
			"category": matching_questions.category,
			"animal_crop": matching_questions.animal_crop,
			"location": matching_questions.location,
			"filename": matching_questions.filename,
		}

	    # Create a list to store answer data for each associated answer
		answer_list = []
		for answer in matching_questions.answers:
			answer_data = {
				"id": answer.id,
				"answer_text": answer.answer_text,
				"source": answer.source,
				"relevance": answer.relevance,
				"coherence": answer.coherence,
				"fluency": answer.fluency,
				"rank": answer.rank,
				"created_at": answer.created_at.strftime("%Y-%m-%d %H:%M:%S"),
			}
			answer_list.append(answer_data)

		random_question_data["answers"] = answer_list

	if random_question_data:
		result_object = {"random_question_data": random_question_data}
		return jsonify(result_object), HTTP_200_OK
	else:
		return jsonify({"message": "No questions available for ranking."}), HTTP_404_NOT_FOUND
	
def upload_to_bucket(bucket_name, source_file_name, destination_blob_name):
    """Uploads a file to a GCP storage bucket."""
    storage_client = storage.Client()
    bucket = storage_client.bucket(bucket_name)
    blob = bucket.blob(destination_blob_name)
    blob.upload_from_filename(source_file_name)
    print(f"File {source_file_name} uploaded to {destination_blob_name} in bucket {bucket_name}.")

	
@questions.route("/fetch_questions", methods=["GET"])
@jwt_required()
def fetch_questions():
	page = request.args.get('page', 1, type=int)
	per_page = request.args.get('per_page', 50, type=int)

	matching_questions = (
		Question.query.filter(
			Question.rephrased == "actual",
    	Question.reviewed == False
			)
		.paginate(page=page, per_page=per_page, error_out=False)
	)
	all = []
	random_question_data = None
	if matching_questions:
		for question in matching_questions:
			answers = [{'text': answer.answer_text, 'source': answer.source} for answer in question.answers]

			random_question_data = {
				"id": question.id,
				"sentence": question.sentence,
				"language": question.language,
				"topic": question.topic,
				"sub_topic": question.sub_topic,
				"category": question.category,
				"animal_crop": question.animal_crop,
				"location": question.location,
				"answers": answers
			}
			all.append(random_question_data)

	if all:
		pagination_details = {
			'total_pages': matching_questions.pages,
			'current_page': matching_questions.page,
			'per_page': per_page,
			'total_questions': matching_questions.total
    }

		return jsonify({'questions': all, 'pagination': pagination_details}), HTTP_200_OK
	else:
		return jsonify({"message": "No questions available."}), HTTP_404_NOT_FOUND


@questions.route("/store_answer_ranks", methods=["POST"])
@jwt_required()
def store_answer_ranks():
	user_id = get_jwt_identity()
	data = request.json
	question_id = data.get("questionId")
	rankings = data.get("rankings")

	if question_id is None or rankings is None:
		return jsonify({"message": "Invalid data format"}), HTTP_400_BAD_REQUEST

	question = Question.query.get(question_id)

	if question is None:
		return jsonify({"error": "Question not found"}), HTTP_404_NOT_FOUND

	ranking_count = 0
	try:
		for ranking in rankings:
			answer_id = ranking.get("answer_id")
			answer = Answer.query.get(answer_id)

			if answer:
				relevance = answer.relevance if answer.relevance is not None else 0
				coherence = answer.coherence if answer.coherence is not None else 0
				fluency = answer.fluency if answer.fluency is not None else 0
				
				relevance = relevance + chanelle(ranking.get("relevance"))
				coherence = coherence + chanelle(ranking.get("coherence"))
				fluency = fluency + chanelle(ranking.get("fluency"))
				
				# answer.context = ranking.get("context")
				if ranking.get("isFlagged"):
					answer.offensive = True

				answer.relevance = relevance
				answer.coherence = coherence
				answer.fluency = fluency
				answer.context = ranking.get("context")


		if question:
			if question.rank_expert_one is None:
				question.rank_expert_one = user_id
				question.ranking_count = 1
			else:
				question.rank_expert_two = user_id
				question.ranking_count = 2

			ranking_count += 1

		if ranking_count == 2 or question.ranking_count == 2:
			question.finished = True

		db.session.commit()
		return jsonify({"message": "Answer ranks stored successfully"}), HTTP_200_OK

	except Exception as e:
		db.session.rollback()
		return jsonify({"message": "Error storing answer ranks"}), HTTP_400_BAD_REQUEST


@questions.route("/expert-stats", methods=["GET"])
@jwt_required()
def question_stats():
	total_cleaned = Question.query.filter_by(cleaned=True, rephrased="actual").count()
	cleaned_and_reviewed = Question.query.filter_by(cleaned=True, reviewed=True, rephrased="actual").count()
	cleaned_reviewed_and_answered = Question.query.filter_by(
		cleaned=True, answered=True, rephrased="actual"
	).count()
	all_fields_true = Question.query.filter_by(cleaned=True, finished=True, rephrased="actual").count()
	experts = User.query.filter_by(role="expert").all()
	english_questions = Question.query.filter(
		Question.rephrased == "actual",
		Question.language.ilike("english")
	).count()
	luganda_questions = Question.query.filter(
		Question.rephrased == "actual",
		Question.language.ilike("luganda")
	).count()
	runyankole_questions = Question.query.filter(
		Question.rephrased == "actual",
		Question.language.ilike("runyankole")
	).count()

	fully_ranked = Question.query.filter(Question.ranking_count == 2).count()
	partial_ranked = Question.query.filter(Question.ranking_count == 1).count()

	expert_data = []
	for expert in experts:
		reviewed_questions_count = Question.query.filter_by(
			reviewer_id=expert.id
		).count()
		answers = Answer.query.filter_by(user_id=expert.id).count()

		ranked_answers = Question.query.filter((Question.rank_expert_one == expert.id) | (Question.rank_expert_two == expert.id)).count()

		expert_info = {
			"id": expert.id,
			"lastname": expert.lastname,
			"firstname": expert.firstname,
			"phone_number": expert.phone_number,
			"reviewed_questions_count": reviewed_questions_count,
			"answers_count": answers,
			"ranked_answers": ranked_answers,
			"language": expert.language,
			"expertise": expert.category,
			"sub_category": expert.sub_category,
			"new_category": expert.new_category,
			"created_at": expert.created_at,
		}

		expert_data.append(expert_info)

	return jsonify(
		{
			"total_cleaned": total_cleaned,
			"cleaned_and_reviewed": cleaned_and_reviewed,
			"cleaned_reviewed_and_answered": cleaned_reviewed_and_answered,
			"all_fields_true": all_fields_true,
			"experts": expert_data,
			"english_questions": english_questions,
			"luganda_questions": luganda_questions,
			"runyankole_questions": runyankole_questions,
			"fully_ranked": fully_ranked,
			"partial_ranked": partial_ranked
		}
	)


@questions.route("/user_answers", methods=["GET"])
@jwt_required()
def get_user_answers():
	user_id = get_jwt_identity()

	reviewed_questions_count = Question.query.filter_by(
		reviewer_id=user_id
	).count()

	questions_count = Question.query.filter(
		Question.answer_expert_one == user_id
	).count()

	answers = Answer.query.filter_by(user_id=user_id).count()

	ranked_answers = Question.query.filter((Question.rank_expert_one == user_id) | (Question.rank_expert_two == user_id)).count()

	user_answers = Answer.query.filter_by(user_id=user_id).all()
	answers_data = []

	for answer in user_answers:
		question = answer.question
		
		answers_data.append(
			{
				"id": answer.id,
				"answer_text": answer.answer_text,
				"created_at": answer.created_at,
				"question_id": answer.question_id,
				"sentence": question.sentence,
				"rank": question.ranking_count
			}
		)
	return jsonify({"questions_count":questions_count, "all_answers":answers_data, "answers": answers,"reviewed_questions": reviewed_questions_count,"ranked": ranked_answers})


@questions.route("/answers/<int:answer_id>", methods=["GET"])
@jwt_required()
def get_answer(answer_id):
	user_id = get_jwt_identity()


	answer = Answer.query.get(answer_id)
	if not answer:
		return jsonify({"error": "Answer not found"}), HTTP_404_NOT_FOUND

	if answer.user_id != user_id:
		return jsonify({"error": "Unauthorized access to answer details"}), 403

	question = Question.query.get(answer.question_id)
	if not question:
		return jsonify({"error": "Question not found"}), HTTP_404_NOT_FOUND

	response_data = {
		"answer_id": answer.id,
		"answer_text": answer.answer_text,
		"question_id": question.id,
		"question_text": question.sentence,
		"language": question.language,
		"animal_crop": question.animal_crop,
		"category": question.category,
		"topic": question.topic,
		"sub_topic": question.sub_topic,
	
	}

	return jsonify(response_data), HTTP_200_OK


@questions.route("/experts/<int:user_id>", methods=["GET"])
@jwt_required()
def get_expert_stats(user_id):
	answers = Answer.query.filter_by(user_id=user_id).all()
	if not answers:
		return jsonify({"error": "Answers not found"}), HTTP_404_NOT_FOUND

	answers_data = []
	for answer in answers:
		
		question = Question.query.get(answer.question_id)
		answers_data.append(
			{
				"answer_id": answer.id,
				"answer_text": answer.answer_text,
				"date": answer.created_at,
				"question_id": question.id,
				"question_text": question.sentence,
				"language": question.language,
				"animal_crop": question.animal_crop,
				"category": question.category,
				"topic": question.topic,
				"sub_topic": question.sub_topic,
			
			}
		)

	return jsonify(answers_data), HTTP_200_OK

@questions.route("/update_answer_text/<int:answer_id>", methods=["PUT"])
@jwt_required()
def update_answer_text(answer_id):
	answer = Answer.query.get(answer_id)
	if not answer:
		return jsonify({"message": "Answer not found"}), HTTP_404_NOT_FOUND
	new_answer_text = request.json.get("answer_text")

	if not new_answer_text:
		return jsonify({"message": "New answer_text not provided"}), HTTP_404_NOT_FOUND

	answer.answer_text = new_answer_text
	db.session.commit()

	return jsonify({"message": "Answer text updated successfully"}), HTTP_200_OK


@questions.route("/upload_json_answers/", methods=["GET"])
@jwt_required()
def upload_json_answers():

	current_user_id = get_jwt_identity()
	dup_count = 0
	duplicates = []

	for obj in embedded_json:
		sentence = obj.get("Questions")
		language = obj.get("language")
		topic = obj.get("Topics")
		sub_topic = obj.get("Sub topics")
		category = obj.get("Category")
		animal_crop = obj.get("animal_crop")
		location = obj.get("Location")

		# Check if the question already exists
		existing_qn = Question.query.filter_by(sentence=sentence, cleaned=True, rephrased="actual").first()
		if existing_qn:
				dup_count += 1
				duplicates.append({"sentence": sentence})
				existing_qn.animal_crop = animal_crop
				db.session.commit()

		else:
				question = Question(
						sentence=sentence,
						language=language,
						user_id=current_user_id,
						topic=topic,
						sub_topic=sub_topic,
						category=category,
						animal_crop=animal_crop,
						location=location,
						cleaned=True,
						rephrased="actual",
						reviewed=True,
						reviewer_id=1
				)
				db.session.add(question)
				db.session.commit()
				question_id = question.id

				response_categories = [
						"Llama2",
						"Bard",
						"Bing",
						"ChatGPT 3.5",
						"GPT 4",
				]
				for category in response_categories:
						response_value = obj.get(category)
						if response_value is not None:
								response = Answer(
										question_id=question_id,
										answer_text=response_value,
										source=category,
										user_id=current_user_id,
								)
								db.session.add(response)
								db.session.commit()

	response_data = {"duplicates_count": dup_count, "duplicates": duplicates}
	return jsonify(response_data), HTTP_200_OK


@questions.route("/issues", methods=["GET"])
@jwt_required()
def get_debug_answers():
	user_id = get_jwt_identity()
	updated_items = []
	list_of_lists = []
	oldpa =[]
	for item in oldpa:
		item_id = item['id']
		db_item = Answer.query.get(item_id)
		
		if db_item:
			list_of_lists.append([item, {
				'id': db_item.id,
				'coherence': db_item.coherence,
				'relevance': db_item.relevance,
				'fluency': db_item.fluency
			}])
			
	
	return jsonify({
		'updated_items': list_of_lists
	})


@questions.route("/expertsanswers", methods=["GET"])
@jwt_required()
def get_experts_and_answers():
	experts = User.query.filter_by(role='expert').all()
	experts_data = []
	
	for expert in experts:
		expert_data = {
			'id': expert.id,
			'username': expert.username,
			'expertise': expert.new_category,
			'answers': []
			}
		answers = Answer.query.filter_by(user_id=expert.id).all()
		
		for answer in answers:
			answer_data = {
				'id': answer.id,
				'question_id': answer.question_id,
				'answer_text': answer.answer_text,
				}
			expert_data['answers'].append(answer_data)
		experts_data.append(expert_data)

	return jsonify(experts_data)


@questions.route("/addexcelanswers", methods=["GET"])
@jwt_required()
def add_excel_answers():
	for expert, expert_data in list_of_expertiz.items():
		print(expert)
		user_id = expert_data['id']
		print(user_id)
		
		user = User.query.get(user_id)
		
		if user is None:
			return jsonify({'message': f'User with ID {user_id} not found'}), 404
		
		expert_answers = derek_list.get(expert, [])
		for answer_data in expert_answers:
			
			question_id = answer_data.get('Question_id')
			answer_text = answer_data.get('Answer')

			existing_question = Question.query.filter_by(id=question_id).first()
			if existing_question:
				new_answer = Answer(
						question_id=question_id,
						user_id=user_id,
						answer_text=answer_text,
						source="expert"
				)
				db.session.add(new_answer)
				existing_question.answered = True
				existing_question.answer_expert_one = user_id
				existing_question.reviewed = True
				existing_question.correct = True
				existing_question.reviewer_id = user_id
	
			db.session.commit()
	
	return jsonify({'message': 'Answers updated successfully'}), 200
